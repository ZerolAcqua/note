
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://note.zerolacqua.top/programming/cpp/head-first-design-pattern/">
      
      
        <link rel="prev" href="../Effective_Modern_C%2B%2B/">
      
      
        <link rel="next" href="../../rust/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.2.3">
    
    
      
        <title>C++ 实现 Headfirst 设计模式 - 丘卡的笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-headfirst" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="丘卡的笔记本" class="md-header__button md-logo" aria-label="丘卡的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            丘卡的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C++ 实现 Headfirst 设计模式
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZerolAcqua/note/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ZerolAcqua/note
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../paper/RS/UAV/%E5%9F%BA%E4%BA%8E%E7%89%A9%E6%8E%A2%E9%A3%9E%E8%A1%8C%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%AD%A3%E5%B0%84%E5%BD%B1%E5%83%8F%E5%BF%AB%E9%80%9F%E5%88%B6%E4%BD%9C/" class="md-tabs__link">
          
  
    
  
  论文

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../course/Photogrammetry/%E8%BF%91%E6%99%AF%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F/" class="md-tabs__link">
          
  
    
  
  课程

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../modern-cpp-features/" class="md-tabs__link">
          
  
    
  
  编程

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cs/computer_system/Putting_the_You_in_CPU/" class="md-tabs__link">
          
  
    
  
  计算机

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../misc/photogrammetry/%E4%BA%91%E5%8F%B0%E6%97%8B%E8%BD%AC%E8%A7%92%E6%8D%A2%E7%AE%97/" class="md-tabs__link">
          
  
    
  
  杂项

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="丘卡的笔记本" class="md-nav__button md-logo" aria-label="丘卡的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    丘卡的笔记本
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZerolAcqua/note/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ZerolAcqua/note
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    论文
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            论文
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            RS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UAV
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            UAV
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/RS/UAV/%E5%9F%BA%E4%BA%8E%E7%89%A9%E6%8E%A2%E9%A3%9E%E8%A1%8C%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%AD%A3%E5%B0%84%E5%BD%B1%E5%83%8F%E5%BF%AB%E9%80%9F%E5%88%B6%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基于物探飞行模式的正射影像快速制作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/RS/UAV/%E4%B8%AD%E5%9B%BD%E5%85%89%E5%AD%A6%E5%8D%AB%E6%98%9F%E5%BD%B1%E5%83%8F%E5%8C%B9%E9%85%8D%E8%9E%8D%E5%90%88%E6%96%B9%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A combined image matching method for Chinese optical satellite imagery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/RS/UAV/%E5%8D%97%E6%9E%81%E6%97%A0%E4%BA%BA%E6%9C%BA%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F%E8%AE%BA%E6%96%87%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    南极无人机摄影测量论文概览
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CV
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            CV
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    图像匹配
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            图像匹配
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/image_matching/LBD%E7%BA%BF%E7%89%B9%E5%BE%81%E6%8F%8F%E8%BF%B0%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LBD 线特征描述算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/image_matching/Sample4Geo_Hard_Negative_Sampling_for_Cross-View_Geo-Localisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample4Geo: Hard Negative Sampling for Cross-View Geo-Localisation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/image_matching/Image_Matching_from_Handcrafted_to_Deep_Features_A_Survey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    从人工特征到深度特征的图像匹配调查
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SfM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            SfM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Structure-from-Motion_Revisited/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SfM 回顾（Colmap）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Skeletal_graphs_for_efficient_structure_from_motion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用于高效 SfM 的骨架图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Structure-and-motion_pipeline_on_a_hierarchical_cluster_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基于分层聚类树的 SfM 
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Improving_the_efficiency_of_hierarchical_structure-and-motion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    提高分层 SfM 效率
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Towards_Linear-Time_Incremental_Structure-from-Motion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性时间的增量式 SfM（VisualSFM）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Modeling_the_World_from_Internet_Photo_Collections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通过互联网影像重建世界（Bundler）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Photo_Tourism_Exploring_Photo_Collections_in_3D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    相片旅行：在三维世界中浏览相片
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Building_Rome_in_a_Day/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    一天建成罗马
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Efficient_structure_from_motion_for_large-scale_UAV_images_A_review_and_a_comparison_of_SfM_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大规模无人机影像的高效 SfM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Multicore_Bundle_Adjustment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多核光束法平差
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Efficient_tree-structured_SfM_by_RANSAC_generalized_Procrustes_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基于 RANSAC 通用 Procrustes 分析的高效树状 SfM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/Divide_and_Conquer_Efficient_Large_Scale_Structure_from_Motion_Using_Graph_Partitioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用图分割的分治高效大规模 SfM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/CV/SfM/SfM_on-the-fly%3A_A_robust_near_real-time_SfM_for_spatiotemporally_disordered_high-resolution_imagery_from_multiple_agents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    实时 SfM：一种面向多智能体时空无序高分辨率影像的鲁棒近实时 SfM 方法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    课程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    专业相关
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            专业相关
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" >
        
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    摄影测量
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            摄影测量
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/Photogrammetry/%E8%BF%91%E6%99%AF%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    近景摄影测量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/Photogrammetry/%E5%8D%AB%E6%98%9F%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    卫星摄影测量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/Photogrammetry/%E6%95%B0%E5%AD%97%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字摄影测量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/Photogrammetry/%E8%A7%A3%E6%9E%90%E6%91%84%E5%BD%B1%E6%B5%8B%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    解析摄影测量
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            RS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/RS/%E9%81%A5%E6%84%9F%E5%9B%BE%E5%83%8F%E8%A7%A3%E8%AF%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    遥感图像解译
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3" >
        
          <label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    测绘
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            测绘
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/geomatics/%E5%A4%A7%E5%9C%B0%E6%B5%8B%E9%87%8F%E5%AD%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大地测量学
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CV
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            CV
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/CV/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字图像处理
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    专业之外
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            专业之外
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            CS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/CS/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多媒体技术
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/CS/%E5%8D%97%E5%A4%A7%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FPA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    南大计算机系统 PA
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    others
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/others/%E9%80%BB%E8%BE%91%E5%AD%A6%E5%AF%BC%E8%AE%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    逻辑学导论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../course/others/%E9%9F%B3%E4%B9%90%E6%AC%A3%E8%B5%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    音乐欣赏
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    编程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            编程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../modern-cpp-features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    现代 C++ 特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Effective_Modern_C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Effective Modern C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    C++ 实现 Headfirst 设计模式
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    C++ 实现 Headfirst 设计模式
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    策略模式
  </a>
  
    <nav class="md-nav" aria-label="策略模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    会叫会飞的鸭子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    观察者模式
  </a>
  
    <nav class="md-nav" aria-label="观察者模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    气象站与气象展示板
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    装饰者模式
  </a>
  
    <nav class="md-nav" aria-label="装饰者模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    咖啡店订单系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    工厂模式
  </a>
  
    <nav class="md-nav" aria-label="工厂模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    披萨店订餐系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    加盟店
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    原料工厂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    单例模式
  </a>
  
    <nav class="md-nav" aria-label="单例模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    巧克力工厂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Rust
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    准备工作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/Rust%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust 程序设计语言
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Julia
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Julia
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../julia/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    准备工作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../julia/Julia_Data_Science/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julia Data Science
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../git/progit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Progit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/bibliometrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文献计量学作业
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            计算机
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机系统
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            计算机系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/computer_system/Putting_the_You_in_CPU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Putting the “You” in CPU
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    杂项
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            杂项
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    摄影测量
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            摄影测量
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/photogrammetry/%E4%BA%91%E5%8F%B0%E6%97%8B%E8%BD%AC%E8%A7%92%E6%8D%A2%E7%AE%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    云台旋转角换算
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    策略模式
  </a>
  
    <nav class="md-nav" aria-label="策略模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    会叫会飞的鸭子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    观察者模式
  </a>
  
    <nav class="md-nav" aria-label="观察者模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    气象站与气象展示板
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    装饰者模式
  </a>
  
    <nav class="md-nav" aria-label="装饰者模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    咖啡店订单系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    工厂模式
  </a>
  
    <nav class="md-nav" aria-label="工厂模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    披萨店订餐系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    加盟店
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    原料工厂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    单例模式
  </a>
  
    <nav class="md-nav" aria-label="单例模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    巧克力工厂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<hr/>
<h1 id="c-headfirst">C++ 实现 Headfirst 设计模式<a class="headerlink" href="#c-headfirst" title="Permanent link">¶</a></h1>
<h2 id="_1">策略模式<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">策略模式</p>
<p>定义算法族，分别封闭起来，让它们之间可以互相替换，此模式让算法的变化独立于使用算法的客户</p>
</div>
<h3 id="_2">会叫会飞的鸭子<a class="headerlink" href="#_2" title="Permanent link">¶</a></h3>
<p>本节要实现一个 <code>Duck</code> 类，鸭子可以飞可以叫。但问题是：</p>
<ul>
<li>
<p>我们可能有不会飞的鸭子，甚至不会叫的鸭子</p>
<ul>
<li>可以通过继承将基类的鸭子飞行和叫的方法覆盖掉，但是类很多的时候，挨个覆盖并不优雅</li>
<li>同样的，如果通过有选择地实现 <code>fly</code> 接口，会产生代码无法复用的问题</li>
</ul>
</li>
</ul>
<p>我们应该利用继承与接口实现 <code>Duck</code> 类的问题。将变化的行为封闭为类，<code>Duck</code> 类将动作“委托”给其他类处理，而不是定义在 <code>Duck</code> 类中。
我们还可以利用 <code>setter</code> 方法动态设定行为。</p>
<pre class="mermaid"><code>classDiagram
    class Duck {
        &lt;&lt; abstract &gt;&gt;
        +virtual void display() = 0
        +void performFly()
        +void performQuack()
        +void setFlyBehavior(shared_ptr~FlyBehavior~ fb)
        +void setQuackBehavior(shared_ptr~QuackBehavior~ qb)
        +void swim()
        -shared_ptr~FlyBehavior~ flyBehavior
        -shared_ptr~QuackBehavior~ quackBehavior
    }
    class FlyBehavior {
        &lt;&lt; interface &gt;&gt;
        +virtual void fly() = 0
    }
    class QuackBehavior {
        &lt;&lt; interface &gt;&gt; 
        +virtual void quack() = 0
    }

    class Mallard {
        +void display() override
    }
    class ModelDuck {
        +void display() override
    }
    Duck --|&gt; FlyBehavior : uses
    Duck --|&gt; QuackBehavior : uses
    Mallard --|&gt; Duck
    ModelDuck --|&gt; Duck</code></pre>
<p>在这里，我们将 <code>Duck</code> 类中的 <code>flyBehavior</code> 和 <code>quackBehavior</code> 都封装为了一个类，其行为由相应的类负责。这样鸭子的行为就和鸭子类无关了。</p>
<p>注意，我们的 <code>Duck</code> 类是一个抽象类，它必须实例化之后才可以使用。使用 C++ 时，为了实现从父类调用子类方法，我们需要使用指针（在这里使用了智能指针），并使用 <code>virtual</code> 关键字。</p>
<p>此外，由于 C++ 中没有 <code>interface</code> 关键字，我们实际还是使用抽象类来实现“接口”，后续的章节也是一样的操作。</p>
<pre class="mermaid"><code>classDiagram
    class QuackBehavior {
        &lt;&lt; interface &gt;&gt; 
        +virtual void quack() = 0
    }
    class Quack {
        +void quack() override
    }
    class Squeak {
        +void quack() override
    }
    class muteQuack {
        +void quack() override
    }

    Quack --|&gt; QuackBehavior
    Squeak --|&gt; QuackBehavior
    muteQuack --|&gt; QuackBehavior</code></pre>
<p>在子类中重写父亲方法，使用 <code>override</code> 关键字可以让编辑器辅助检查是否重写了虚函数，避免因函数参数不同等问题，造成重写失败。</p>
<pre class="mermaid"><code>classDiagram
    class FlyBehavior {
        &lt;&lt; interface &gt;&gt;
        +virtual void fly() = 0
    }
    class FlyWithWings {
        +void fly() override
    }
    class FlyNoWay {
        +void fly() override
    }
    class FlyRocketPowered {
        +void fly() override
    }

    FlyWithWings --|&gt; FlyBehavior
    FlyNoWay --|&gt; FlyBehavior
    FlyRocketPowered --|&gt; FlyBehavior</code></pre>
<p>那么这样就实现了鸭子类的功能。我们封装了变化。使用组合而不是继承，增加了代码的复用性，同时便于拓展。</p>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// Strategy Pattern</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">FlyBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">fly</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="p">};</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">QuackBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">quack</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="p">};</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="c1">// abstract class</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Duck</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">FlyBehavior</span><span class="o">&gt;</span><span class="w"> </span><span class="n">flyBehavior</span><span class="p">;</span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">QuackBehavior</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quackBehavior</span><span class="p">;</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="n">Duck</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="kt">void</span><span class="w"> </span><span class="nf">performFly</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">flyBehavior</span><span class="o">-&gt;</span><span class="n">fly</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="kt">void</span><span class="w"> </span><span class="nf">performQuack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">quackBehavior</span><span class="o">-&gt;</span><span class="n">quack</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setFlyBehavior</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">FlyBehavior</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">flyBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fb</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setQuackBehavior</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">QuackBehavior</span><span class="o">&gt;</span><span class="w"> </span><span class="n">qb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">quackBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qb</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="kt">void</span><span class="w"> </span><span class="nf">swim</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"All ducks float, even decoys!"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="p">};</span>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">FlyWithWings</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FlyBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="kt">void</span><span class="w"> </span><span class="n">fly</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I'm flying!!"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="p">};</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">class</span><span class="w"> </span><span class="nc">FlyNoWay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FlyBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="kt">void</span><span class="w"> </span><span class="n">fly</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I can't fly"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="p">};</span>
<a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">class</span><span class="w"> </span><span class="nc">FlyRocketPowered</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FlyBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="kt">void</span><span class="w"> </span><span class="n">fly</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I'm flying with a rocket"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="p">};</span>
<a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">class</span><span class="w"> </span><span class="nc">Quack</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">QuackBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="kt">void</span><span class="w"> </span><span class="n">quack</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Quack"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">};</span>
<a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">class</span><span class="w"> </span><span class="nc">Squeak</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">QuackBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="kt">void</span><span class="w"> </span><span class="n">quack</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Squeak"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="p">};</span>
<a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">class</span><span class="w"> </span><span class="nc">muteQuack</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">QuackBehavior</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="kt">void</span><span class="w"> </span><span class="n">quack</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"&lt;&lt; Silence &gt;&gt;"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="p">};</span>
<a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">class</span><span class="w"> </span><span class="nc">Mallard</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Duck</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="n">Mallard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="n">quackBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quack</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="n">flyBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">FlyWithWings</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="p">}</span>
<a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I'm a real Mallard duck"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="p">};</span>
<a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelDuck</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Duck</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="n">ModelDuck</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="n">flyBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">FlyNoWay</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="n">quackBehavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quack</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="p">}</span>
<a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I'm a model duck"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="p">};</span>
<a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Duck</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mallard</span><span class="p">(</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Mallard</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="n">mallard</span><span class="o">-&gt;</span><span class="n">performQuack</span><span class="p">();</span>
<a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="n">mallard</span><span class="o">-&gt;</span><span class="n">performFly</span><span class="p">();</span>
<a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Duck</span><span class="o">&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">(</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ModelDuck</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="n">model</span><span class="o">-&gt;</span><span class="n">performFly</span><span class="p">();</span>
<a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="n">model</span><span class="o">-&gt;</span><span class="n">setFlyBehavior</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">FlyRocketPowered</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="n">model</span><span class="o">-&gt;</span><span class="n">performFly</span><span class="p">();</span>
<a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="p">}</span>
</code></pre></div>
</details>
<h3 id="_3">总结<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<p>设计原则</p>
<ul>
<li>封装变化</li>
<li>多用组合，少用继承</li>
<li>针对接口编程，不针对实现编程</li>
</ul>
<h2 id="_4">观察者模式<a class="headerlink" href="#_4" title="Permanent link">¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">观察者模式</p>
<p>定义了对象之间的一对多依赖，这样一来，当一个对象改变状态时，它的所有依赖者都会收到通知并自动更新</p>
</div>
<h3 id="_5">气象站与气象展示板<a class="headerlink" href="#_5" title="Permanent link">¶</a></h3>
<p>本节需要实现气象站与气象展示板的关系。气象站会定时更新气象数据，而气象展示板会显示最新的气象数据。</p>
<p>一种不合适的做法是在气象站类中直接调用气象展示板的方法，这样会导致气象站和气象展示板之间的耦合度过高。一旦气象展示板需要增加或减少，气象站类也需要修改。（不应当针对具体实现编程）</p>
<p>我们可以使用观察者模式来解决这个问题。观察者模式定义了对象之间的一对多依赖，这样一来，当一个对象改变状态时，它的所有依赖者都会收到通知并自动更新。
并且，观察者可以自由地订阅或取消订阅。</p>
<p>首先是 <code>Subject</code> 和 <code>Observer</code> 的接口。这里我们采用的是主题“推”数据的方式，即主题将数据推送给观察者。
关于“推”和“拉”的区别在于，如果使用“拉”数据的方式，观察者需要主动去获取数据，可以有选择地使用 <code>getter</code> 方法获取数据；而使用“推”数据的方式，主题会主动将数据推送给观察者，推送的数据是主题的全部数据，而不是观察者需要的特定部分数据。一般来说，“推”的方式更为“正确”</p>
<p>需要注意的是，由于观察者定义需要有主题的定义，主题定义也需要观察者的定义，在定义两个类时，需要使用前向声明，否则会出现编译错误。</p>
<pre class="mermaid"><code>classDiagram
    class Subject {
        &lt;&lt; interface &gt;&gt;
        +virtual void registerObserver(shared_ptr~Observer~ o) = 0
        +virtual void removeObserver(shared_ptr~Observer~ o) = 0
        +virtual void notifyObservers() = 0
    }
    class Observer {
        &lt;&lt; interface &gt;&gt;
        +virtual void setSubject(shared_ptr~Subject~ s) = 0
        +virtual void removeSubject() = 0
        +virtual void update(float temp, float humidity, float pressure) = 0
    }
    Subject "1"--&gt;"1..*" Observer : notifies</code></pre>
<p><code>WeatherData</code> 类实现了主题类，它维护了一个观察者列表，并且实现了注册、删除和通知观察者的方法。同时，<code>WeatherData</code> 类还维护了气象数据的状态，并且在数据发生变化时通知观察者。</p>
<pre class="mermaid"><code>classDiagram

    class Subject {
        &lt;&lt; interface &gt;&gt;
        +virtual void registerObserver(shared_ptr~Observer~ o) = 0
        +virtual void removeObserver(shared_ptr~Observer~ o) = 0
        +virtual void notifyObservers() = 0
    }

    class WeatherData {
        +void registerObserver(shared_ptr~Observer~ o) override
        +void removeObserver(shared_ptr~Observer~ o) override
        +void notifyObservers() override
        +void measurementsChanged()
        +void setMeasurements(float temperature, float humidity, float pressure)
        -vector~shared_ptr~Observer~~ observers
        -float temperature
        -float humidity
        -float pressure
    }

    Subject &lt;|-- WeatherData 

</code></pre>
<p><code>DisplayElement</code> 抽象类和各个展示板的实现类。在观察者模式中，由于主题和观察者相互持有对方的引用，因此需要使用 <code>weak_ptr</code> 来避免循环引用。</p>
<p>同时，因为观察者类在设置主题时，需要调用主题的注册方法，这也就意味需要把一个 <code>this</code> 指针创建为 <code>shared_ptr</code> 传递给主题。
如果有多个主题，使用 <code>this</code> 裸指针会导致多次创建 <code>shared_ptr</code>。
从裸指针创建 <code>shared_ptr</code> 只可创建一次，否则多次创建 <code>shared_ptr</code>，会导致多次创建控制块，引发错误。</p>
<p>因此我们需要继承 <code>enable_shared_from_this&lt;T&gt;</code> 来保证 <code>this</code> 指针只创建一次控制块。
关于这个 <code>enable_shared_from_this&lt;T&gt;</code> 的用法，有一个专门的名字叫奇异递归模板模式，可以自行搜索。需要注意的是，调用 <code>shared_from_this()</code> 时，必须保证 已经调用过 <code>shared_ptr&lt;T&gt;</code> 的构造函数，否则会报错（即，类实例是一个由 <code>shared_ptr</code> 管理的对象）。</p>
<pre class="mermaid"><code>classDiagram
    class DisplayElement {
        &lt;&lt; interface &gt;&gt;
        +virtual void display() = 0
    }

    class Observer {
        &lt;&lt; interface &gt;&gt;
        +virtual void setSubject(shared_ptr~Subject~ s) = 0
        +virtual void removeSubject() = 0
        +virtual void update(float temp, float humidity, float pressure) = 0
    }

    class CurrentConditionsDisplay {
        +void setSubject(shared_ptr~Subject~ s) override
        +void removeSubject() override
        +void update(float temperature, float humidity, float pressure)
        +void display() override
        -float temperature
        -float humidity
        -weak_ptr~Subject~ weatherData
    }

    class StatisticsDisplay {
        +void setSubject(shared_ptr~Subject~ s) override
        +void removeSubject() override
        +void update(float temperature, float humidity, float pressure)
        +void display() override
        -float temperature
        -float humidity
        -weak_ptr~Subject~ weatherData
    }

    Observer &lt;|-- CurrentConditionsDisplay
    Observer &lt;|-- StatisticsDisplay
    DisplayElement &lt;|-- CurrentConditionsDisplay
    DisplayElement &lt;|-- StatisticsDisplay
</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// observer pattern</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Subject</span><span class="p">;</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Observer</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">setSubject</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeSubject</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="p">};</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Subject</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeObserver</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">notifyObservers</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="p">};</span>
<a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>
<a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">DisplayElement</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="p">};</span>
<a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="k">class</span><span class="w"> </span><span class="nc">WeatherData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Subject</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">observers</span><span class="p">;</span>
<a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-35" id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span>
<a href="#__codelineno-1-36" id="__codelineno-1-36" name="__codelineno-1-36"></a>
<a href="#__codelineno-1-37" id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-38" id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="kt">void</span><span class="w"> </span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-39" id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">    </span><span class="n">observers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>
<a href="#__codelineno-1-40" id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="p">}</span>
<a href="#__codelineno-1-41" id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="kt">void</span><span class="w"> </span><span class="n">removeObserver</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-42" id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">observers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">observers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">o</span><span class="p">);</span>
<a href="#__codelineno-1-43" id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">observers</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-44" id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">    </span><span class="n">observers</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
<a href="#__codelineno-1-45" id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-46" id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="p">}</span>
<a href="#__codelineno-1-47" id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="kt">void</span><span class="w"> </span><span class="n">notifyObservers</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-48" id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">observers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-49" id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">    </span><span class="n">o</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">);</span>
<a href="#__codelineno-1-50" id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-51" id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="p">}</span>
<a href="#__codelineno-1-52" id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="kt">void</span><span class="w"> </span><span class="n">measurementsChanged</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">notifyObservers</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-1-53" id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="kt">void</span><span class="w"> </span><span class="n">setMeasurements</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-54" id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-55" id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-56" id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span>
<a href="#__codelineno-1-57" id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="w">    </span><span class="n">measurementsChanged</span><span class="p">();</span>
<a href="#__codelineno-1-58" id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="p">}</span>
<a href="#__codelineno-1-59" id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="p">};</span>
<a href="#__codelineno-1-60" id="__codelineno-1-60" name="__codelineno-1-60"></a>
<a href="#__codelineno-1-61" id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="k">class</span><span class="w"> </span><span class="nc">CurrentConditionsDisplay</span>
<a href="#__codelineno-1-62" id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Observer</span><span class="p">,</span>
<a href="#__codelineno-1-63" id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">    </span><span class="n">DisplayElement</span><span class="p">,</span>
<a href="#__codelineno-1-64" id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">CurrentConditionsDisplay</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-65" id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-66" id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-67" id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-68" id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">weatherData</span><span class="p">;</span><span class="w"> </span><span class="c1">// actually, one observer can observe many</span>
<a href="#__codelineno-1-69" id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">                                </span><span class="c1">// subjects, but we don't implement it here</span>
<a href="#__codelineno-1-70" id="__codelineno-1-70" name="__codelineno-1-70"></a>
<a href="#__codelineno-1-71" id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-72" id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="n">CurrentConditionsDisplay</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a href="#__codelineno-1-73" id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="o">~</span><span class="n">CurrentConditionsDisplay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">removeSubject</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-1-74" id="__codelineno-1-74" name="__codelineno-1-74"></a>
<a href="#__codelineno-1-75" id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="kt">void</span><span class="w"> </span><span class="n">setSubject</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-76" id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-77" id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-78" id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-79" id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">    </span><span class="n">weatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a href="#__codelineno-1-80" id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-81" id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="p">}</span>
<a href="#__codelineno-1-82" id="__codelineno-1-82" name="__codelineno-1-82"></a>
<a href="#__codelineno-1-83" id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="kt">void</span><span class="w"> </span><span class="n">removeSubject</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-84" id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a href="#__codelineno-1-85" id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-86" id="__codelineno-1-86" name="__codelineno-1-86"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-87" id="__codelineno-1-87" name="__codelineno-1-87"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-88" id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="w">    </span><span class="n">sptrWeatherData</span><span class="o">-&gt;</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-89" id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="w">    </span><span class="n">weatherData</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a href="#__codelineno-1-90" id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="p">}</span>
<a href="#__codelineno-1-91" id="__codelineno-1-91" name="__codelineno-1-91"></a>
<a href="#__codelineno-1-92" id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-93" id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-94" id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-95" id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="w">    </span><span class="n">display</span><span class="p">();</span>
<a href="#__codelineno-1-96" id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="p">}</span>
<a href="#__codelineno-1-97" id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-98" id="__codelineno-1-98" name="__codelineno-1-98"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Current conditions: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"F degrees and "</span>
<a href="#__codelineno-1-99" id="__codelineno-1-99" name="__codelineno-1-99"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">humidity</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"% humidity"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-1-100" id="__codelineno-1-100" name="__codelineno-1-100"></a><span class="p">}</span>
<a href="#__codelineno-1-101" id="__codelineno-1-101" name="__codelineno-1-101"></a><span class="p">};</span>
<a href="#__codelineno-1-102" id="__codelineno-1-102" name="__codelineno-1-102"></a>
<a href="#__codelineno-1-103" id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="k">class</span><span class="w"> </span><span class="nc">StatisticsDisplay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Observer</span><span class="p">,</span>
<a href="#__codelineno-1-104" id="__codelineno-1-104" name="__codelineno-1-104"></a><span class="w">                        </span><span class="n">DisplayElement</span><span class="p">,</span>
<a href="#__codelineno-1-105" id="__codelineno-1-105" name="__codelineno-1-105"></a><span class="w">                        </span><span class="k">public</span><span class="w"> </span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">StatisticsDisplay</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-106" id="__codelineno-1-106" name="__codelineno-1-106"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-107" id="__codelineno-1-107" name="__codelineno-1-107"></a><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-108" id="__codelineno-1-108" name="__codelineno-1-108"></a><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-109" id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">weatherData</span><span class="p">;</span>
<a href="#__codelineno-1-110" id="__codelineno-1-110" name="__codelineno-1-110"></a>
<a href="#__codelineno-1-111" id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-112" id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="kt">void</span><span class="w"> </span><span class="n">setSubject</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-113" id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-114" id="__codelineno-1-114" name="__codelineno-1-114"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-115" id="__codelineno-1-115" name="__codelineno-1-115"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-116" id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="w">    </span><span class="n">weatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a href="#__codelineno-1-117" id="__codelineno-1-117" name="__codelineno-1-117"></a><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-118" id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="p">}</span>
<a href="#__codelineno-1-119" id="__codelineno-1-119" name="__codelineno-1-119"></a>
<a href="#__codelineno-1-120" id="__codelineno-1-120" name="__codelineno-1-120"></a><span class="kt">void</span><span class="w"> </span><span class="n">removeSubject</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-121" id="__codelineno-1-121" name="__codelineno-1-121"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a href="#__codelineno-1-122" id="__codelineno-1-122" name="__codelineno-1-122"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-123" id="__codelineno-1-123" name="__codelineno-1-123"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-124" id="__codelineno-1-124" name="__codelineno-1-124"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-125" id="__codelineno-1-125" name="__codelineno-1-125"></a><span class="w">    </span><span class="n">sptrWeatherData</span><span class="o">-&gt;</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-126" id="__codelineno-1-126" name="__codelineno-1-126"></a><span class="w">    </span><span class="n">weatherData</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a href="#__codelineno-1-127" id="__codelineno-1-127" name="__codelineno-1-127"></a><span class="p">}</span>
<a href="#__codelineno-1-128" id="__codelineno-1-128" name="__codelineno-1-128"></a>
<a href="#__codelineno-1-129" id="__codelineno-1-129" name="__codelineno-1-129"></a><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-130" id="__codelineno-1-130" name="__codelineno-1-130"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-131" id="__codelineno-1-131" name="__codelineno-1-131"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-132" id="__codelineno-1-132" name="__codelineno-1-132"></a><span class="w">    </span><span class="n">display</span><span class="p">();</span>
<a href="#__codelineno-1-133" id="__codelineno-1-133" name="__codelineno-1-133"></a><span class="p">}</span>
<a href="#__codelineno-1-134" id="__codelineno-1-134" name="__codelineno-1-134"></a>
<a href="#__codelineno-1-135" id="__codelineno-1-135" name="__codelineno-1-135"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-136" id="__codelineno-1-136" name="__codelineno-1-136"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Statistics: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"F degrees and "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">humidity</span>
<a href="#__codelineno-1-137" id="__codelineno-1-137" name="__codelineno-1-137"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"% humidity"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-1-138" id="__codelineno-1-138" name="__codelineno-1-138"></a><span class="p">}</span>
<a href="#__codelineno-1-139" id="__codelineno-1-139" name="__codelineno-1-139"></a><span class="p">};</span>
<a href="#__codelineno-1-140" id="__codelineno-1-140" name="__codelineno-1-140"></a>
<a href="#__codelineno-1-141" id="__codelineno-1-141" name="__codelineno-1-141"></a><span class="k">class</span><span class="w"> </span><span class="nc">ForecastDisplay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Observer</span><span class="p">,</span>
<a href="#__codelineno-1-142" id="__codelineno-1-142" name="__codelineno-1-142"></a><span class="w">                        </span><span class="n">DisplayElement</span><span class="p">,</span>
<a href="#__codelineno-1-143" id="__codelineno-1-143" name="__codelineno-1-143"></a><span class="w">                        </span><span class="k">public</span><span class="w"> </span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">ForecastDisplay</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-144" id="__codelineno-1-144" name="__codelineno-1-144"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-145" id="__codelineno-1-145" name="__codelineno-1-145"></a><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-146" id="__codelineno-1-146" name="__codelineno-1-146"></a><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-147" id="__codelineno-1-147" name="__codelineno-1-147"></a><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">weatherData</span><span class="p">;</span>
<a href="#__codelineno-1-148" id="__codelineno-1-148" name="__codelineno-1-148"></a>
<a href="#__codelineno-1-149" id="__codelineno-1-149" name="__codelineno-1-149"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-150" id="__codelineno-1-150" name="__codelineno-1-150"></a><span class="kt">void</span><span class="w"> </span><span class="n">setSubject</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-151" id="__codelineno-1-151" name="__codelineno-1-151"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-152" id="__codelineno-1-152" name="__codelineno-1-152"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-153" id="__codelineno-1-153" name="__codelineno-1-153"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-154" id="__codelineno-1-154" name="__codelineno-1-154"></a><span class="w">    </span><span class="n">weatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a href="#__codelineno-1-155" id="__codelineno-1-155" name="__codelineno-1-155"></a><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-156" id="__codelineno-1-156" name="__codelineno-1-156"></a><span class="p">}</span>
<a href="#__codelineno-1-157" id="__codelineno-1-157" name="__codelineno-1-157"></a>
<a href="#__codelineno-1-158" id="__codelineno-1-158" name="__codelineno-1-158"></a><span class="kt">void</span><span class="w"> </span><span class="n">removeSubject</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-159" id="__codelineno-1-159" name="__codelineno-1-159"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a href="#__codelineno-1-160" id="__codelineno-1-160" name="__codelineno-1-160"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-161" id="__codelineno-1-161" name="__codelineno-1-161"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-162" id="__codelineno-1-162" name="__codelineno-1-162"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-163" id="__codelineno-1-163" name="__codelineno-1-163"></a><span class="w">    </span><span class="n">sptrWeatherData</span><span class="o">-&gt;</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-164" id="__codelineno-1-164" name="__codelineno-1-164"></a><span class="w">    </span><span class="n">weatherData</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a href="#__codelineno-1-165" id="__codelineno-1-165" name="__codelineno-1-165"></a><span class="p">}</span>
<a href="#__codelineno-1-166" id="__codelineno-1-166" name="__codelineno-1-166"></a>
<a href="#__codelineno-1-167" id="__codelineno-1-167" name="__codelineno-1-167"></a><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-168" id="__codelineno-1-168" name="__codelineno-1-168"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-169" id="__codelineno-1-169" name="__codelineno-1-169"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-170" id="__codelineno-1-170" name="__codelineno-1-170"></a><span class="w">    </span><span class="n">display</span><span class="p">();</span>
<a href="#__codelineno-1-171" id="__codelineno-1-171" name="__codelineno-1-171"></a><span class="p">}</span>
<a href="#__codelineno-1-172" id="__codelineno-1-172" name="__codelineno-1-172"></a>
<a href="#__codelineno-1-173" id="__codelineno-1-173" name="__codelineno-1-173"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-174" id="__codelineno-1-174" name="__codelineno-1-174"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Forecast: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"F degrees and "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">humidity</span>
<a href="#__codelineno-1-175" id="__codelineno-1-175" name="__codelineno-1-175"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"% humidity"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-1-176" id="__codelineno-1-176" name="__codelineno-1-176"></a><span class="p">}</span>
<a href="#__codelineno-1-177" id="__codelineno-1-177" name="__codelineno-1-177"></a><span class="p">};</span>
<a href="#__codelineno-1-178" id="__codelineno-1-178" name="__codelineno-1-178"></a>
<a href="#__codelineno-1-179" id="__codelineno-1-179" name="__codelineno-1-179"></a><span class="k">class</span><span class="w"> </span><span class="nc">HeatIndexDisplay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Observer</span><span class="p">,</span>
<a href="#__codelineno-1-180" id="__codelineno-1-180" name="__codelineno-1-180"></a><span class="w">                        </span><span class="n">DisplayElement</span><span class="p">,</span>
<a href="#__codelineno-1-181" id="__codelineno-1-181" name="__codelineno-1-181"></a><span class="w">                        </span><span class="k">public</span><span class="w"> </span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">HeatIndexDisplay</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-182" id="__codelineno-1-182" name="__codelineno-1-182"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-183" id="__codelineno-1-183" name="__codelineno-1-183"></a><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-184" id="__codelineno-1-184" name="__codelineno-1-184"></a><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-185" id="__codelineno-1-185" name="__codelineno-1-185"></a><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">weatherData</span><span class="p">;</span>
<a href="#__codelineno-1-186" id="__codelineno-1-186" name="__codelineno-1-186"></a>
<a href="#__codelineno-1-187" id="__codelineno-1-187" name="__codelineno-1-187"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-1-188" id="__codelineno-1-188" name="__codelineno-1-188"></a><span class="kt">void</span><span class="w"> </span><span class="n">setSubject</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Subject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-189" id="__codelineno-1-189" name="__codelineno-1-189"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-190" id="__codelineno-1-190" name="__codelineno-1-190"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-191" id="__codelineno-1-191" name="__codelineno-1-191"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-192" id="__codelineno-1-192" name="__codelineno-1-192"></a><span class="w">    </span><span class="n">weatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a href="#__codelineno-1-193" id="__codelineno-1-193" name="__codelineno-1-193"></a><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">registerObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-194" id="__codelineno-1-194" name="__codelineno-1-194"></a><span class="p">}</span>
<a href="#__codelineno-1-195" id="__codelineno-1-195" name="__codelineno-1-195"></a>
<a href="#__codelineno-1-196" id="__codelineno-1-196" name="__codelineno-1-196"></a><span class="kt">void</span><span class="w"> </span><span class="n">removeSubject</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-197" id="__codelineno-1-197" name="__codelineno-1-197"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherData</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<a href="#__codelineno-1-198" id="__codelineno-1-198" name="__codelineno-1-198"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sptrWeatherData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-199" id="__codelineno-1-199" name="__codelineno-1-199"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a href="#__codelineno-1-200" id="__codelineno-1-200" name="__codelineno-1-200"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-1-201" id="__codelineno-1-201" name="__codelineno-1-201"></a><span class="w">    </span><span class="n">sptrWeatherData</span><span class="o">-&gt;</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">shared_from_this</span><span class="p">());</span>
<a href="#__codelineno-1-202" id="__codelineno-1-202" name="__codelineno-1-202"></a><span class="w">    </span><span class="n">weatherData</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a href="#__codelineno-1-203" id="__codelineno-1-203" name="__codelineno-1-203"></a><span class="p">}</span>
<a href="#__codelineno-1-204" id="__codelineno-1-204" name="__codelineno-1-204"></a>
<a href="#__codelineno-1-205" id="__codelineno-1-205" name="__codelineno-1-205"></a><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">humidity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pressure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-206" id="__codelineno-1-206" name="__codelineno-1-206"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<a href="#__codelineno-1-207" id="__codelineno-1-207" name="__codelineno-1-207"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<a href="#__codelineno-1-208" id="__codelineno-1-208" name="__codelineno-1-208"></a><span class="w">    </span><span class="n">display</span><span class="p">();</span>
<a href="#__codelineno-1-209" id="__codelineno-1-209" name="__codelineno-1-209"></a><span class="p">}</span>
<a href="#__codelineno-1-210" id="__codelineno-1-210" name="__codelineno-1-210"></a>
<a href="#__codelineno-1-211" id="__codelineno-1-211" name="__codelineno-1-211"></a><span class="kt">void</span><span class="w"> </span><span class="n">display</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-212" id="__codelineno-1-212" name="__codelineno-1-212"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Heat index is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">computeHeatIndex</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">humidity</span><span class="p">)</span>
<a href="#__codelineno-1-213" id="__codelineno-1-213" name="__codelineno-1-213"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-1-214" id="__codelineno-1-214" name="__codelineno-1-214"></a><span class="p">}</span>
<a href="#__codelineno-1-215" id="__codelineno-1-215" name="__codelineno-1-215"></a>
<a href="#__codelineno-1-216" id="__codelineno-1-216" name="__codelineno-1-216"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-1-217" id="__codelineno-1-217" name="__codelineno-1-217"></a><span class="kt">double</span><span class="w"> </span><span class="n">computeHeatIndex</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-218" id="__codelineno-1-218" name="__codelineno-1-218"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-1-219" id="__codelineno-1-219" name="__codelineno-1-219"></a><span class="w">        </span><span class="p">(</span><span class="mf">16.923</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.85212</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.37941</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.100254</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-220" id="__codelineno-1-220" name="__codelineno-1-220"></a><span class="w">        </span><span class="mf">0.00941695</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.00728898</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-221" id="__codelineno-1-221" name="__codelineno-1-221"></a><span class="w">        </span><span class="mf">0.000345372</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.000814971</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-222" id="__codelineno-1-222" name="__codelineno-1-222"></a><span class="w">        </span><span class="mf">0.0000102102</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.000038646</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-223" id="__codelineno-1-223" name="__codelineno-1-223"></a><span class="w">        </span><span class="mf">0.0000291583</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.00000142721</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-224" id="__codelineno-1-224" name="__codelineno-1-224"></a><span class="w">        </span><span class="mf">0.000000197483</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<a href="#__codelineno-1-225" id="__codelineno-1-225" name="__codelineno-1-225"></a><span class="w">        </span><span class="mf">0.0000000218429</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-1-226" id="__codelineno-1-226" name="__codelineno-1-226"></a><span class="w">        </span><span class="mf">0.000000000843296</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<a href="#__codelineno-1-227" id="__codelineno-1-227" name="__codelineno-1-227"></a><span class="w">        </span><span class="mf">0.0000000000481975</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rh</span><span class="p">));</span>
<a href="#__codelineno-1-228" id="__codelineno-1-228" name="__codelineno-1-228"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<a href="#__codelineno-1-229" id="__codelineno-1-229" name="__codelineno-1-229"></a><span class="p">}</span>
<a href="#__codelineno-1-230" id="__codelineno-1-230" name="__codelineno-1-230"></a><span class="p">};</span>
<a href="#__codelineno-1-231" id="__codelineno-1-231" name="__codelineno-1-231"></a>
<a href="#__codelineno-1-232" id="__codelineno-1-232" name="__codelineno-1-232"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-1-233" id="__codelineno-1-233" name="__codelineno-1-233"></a><span class="p">{</span>
<a href="#__codelineno-1-234" id="__codelineno-1-234" name="__codelineno-1-234"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">weatherData</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">WeatherData</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-1-235" id="__codelineno-1-235" name="__codelineno-1-235"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">currentDisplay</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CurrentConditionsDisplay</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-1-236" id="__codelineno-1-236" name="__codelineno-1-236"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">statisticsDisplay</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">StatisticsDisplay</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-1-237" id="__codelineno-1-237" name="__codelineno-1-237"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">forecastDisplay</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ForecastDisplay</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-1-238" id="__codelineno-1-238" name="__codelineno-1-238"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">heatIndexDisplay</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">HeatIndexDisplay</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-1-239" id="__codelineno-1-239" name="__codelineno-1-239"></a>
<a href="#__codelineno-1-240" id="__codelineno-1-240" name="__codelineno-1-240"></a><span class="w">    </span><span class="n">weatherData</span><span class="o">-&gt;</span><span class="n">setMeasurements</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="mf">30.4</span><span class="p">);</span>
<a href="#__codelineno-1-241" id="__codelineno-1-241" name="__codelineno-1-241"></a><span class="w">    </span><span class="n">currentDisplay</span><span class="o">-&gt;</span><span class="n">setSubject</span><span class="p">(</span><span class="n">weatherData</span><span class="p">);</span>
<a href="#__codelineno-1-242" id="__codelineno-1-242" name="__codelineno-1-242"></a><span class="w">    </span><span class="n">statisticsDisplay</span><span class="o">-&gt;</span><span class="n">setSubject</span><span class="p">(</span><span class="n">weatherData</span><span class="p">);</span>
<a href="#__codelineno-1-243" id="__codelineno-1-243" name="__codelineno-1-243"></a><span class="w">    </span><span class="n">forecastDisplay</span><span class="o">-&gt;</span><span class="n">setSubject</span><span class="p">(</span><span class="n">weatherData</span><span class="p">);</span>
<a href="#__codelineno-1-244" id="__codelineno-1-244" name="__codelineno-1-244"></a><span class="w">    </span><span class="n">heatIndexDisplay</span><span class="o">-&gt;</span><span class="n">setSubject</span><span class="p">(</span><span class="n">weatherData</span><span class="p">);</span>
<a href="#__codelineno-1-245" id="__codelineno-1-245" name="__codelineno-1-245"></a><span class="w">    </span><span class="n">weatherData</span><span class="o">-&gt;</span><span class="n">setMeasurements</span><span class="p">(</span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mf">29.2</span><span class="p">);</span>
<a href="#__codelineno-1-246" id="__codelineno-1-246" name="__codelineno-1-246"></a><span class="w">    </span><span class="n">currentDisplay</span><span class="o">-&gt;</span><span class="n">removeSubject</span><span class="p">();</span>
<a href="#__codelineno-1-247" id="__codelineno-1-247" name="__codelineno-1-247"></a><span class="w">    </span><span class="n">weatherData</span><span class="o">-&gt;</span><span class="n">setMeasurements</span><span class="p">(</span><span class="mi">78</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mf">29.2</span><span class="p">);</span>
<a href="#__codelineno-1-248" id="__codelineno-1-248" name="__codelineno-1-248"></a><span class="p">}</span>
<a href="#__codelineno-1-249" id="__codelineno-1-249" name="__codelineno-1-249"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-250" id="__codelineno-1-250" name="__codelineno-1-250"></a><span class="p">}</span>
</code></pre></div>
</details>
<h3 id="_6">总结<a class="headerlink" href="#_6" title="Permanent link">¶</a></h3>
<p>要点</p>
<ul>
<li>主题需要管理订阅的观察者，以及一个通知观察者的函数</li>
<li>观察者需要向主题提供一个更新函数</li>
<li>观察者包含主题的一个引用可以更方便地取消订阅</li>
<li>可以通过 <code>setChanged</code> 方法控制主题的通知频率，避免主题对数据变化太过敏感</li>
<li>不应该依赖于通知的顺序</li>
</ul>
<p>设计原则</p>
<ul>
<li>封装变化</li>
<li>多用组合，少用继承</li>
<li>针对接口编程，不针对实现编程</li>
<li>为了交互对象之间的松耦合设计而努力</li>
</ul>
<h2 id="_7">装饰者模式<a class="headerlink" href="#_7" title="Permanent link">¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">装饰者模式</p>
<p>动态地将责任附加到对象上。若要扩展功能，装饰者提供了比继承更有弹性的替代方案</p>
</div>
<h3 id="_8">咖啡店订单系统<a class="headerlink" href="#_8" title="Permanent link">¶</a></h3>
<p>饮料类有一个抽象基类，各种饮料都继承自这个基类。</p>
<ul>
<li>我们就需要在每个饮料类中添加这些调料，这样会导致代码的复杂性增加。</li>
<li>如何计算价格也是一个问题</li>
</ul>
<p>使用实例变量记录添加的配料，从而简化价格计算，这种方法也不是很好。</p>
<ul>
<li>配料的价格会变动</li>
<li>以后可能会有新的配料加入</li>
<li>有些饮料不适合加入某些配料</li>
</ul>
<p>使用装饰者模式可以解决这个问题。以饮料为主体，运行时以调料来“装饰”饮料</p>
<ul>
<li>装饰者和被装饰对象有相同的超类型</li>
<li>可以用一或者多个装饰者包装一个对象</li>
<li>在任何需要原始对象的场合，可以用装饰过的对象代替它</li>
<li>装饰者可以在所委托被装饰者的行为之前与/或之后，加上自己的行为，以达到特定的目的</li>
<li>对象可以在任何时候被装饰，所以可以在运行时动态地，不限量地用合适的装饰者来装饰对象</li>
</ul>
<pre class="mermaid"><code>classDiagram
    class Beverage {
        &lt;&lt; abstract &gt;&gt;
        +virtual string getDescription()
        +virtual double cost() = 0
        #string description
    }
    class Espresso {
        +Espresso()
        +double cost() override
    }
    class OtherBeverage {
        +OtherBeverage()
        +double cost() override
    }
    class CondimentDecorator {
        &lt;&lt; abstract &gt;&gt;
        +virtual string getDescription() = 0
    }
    class Mocha {
        +Mocha(shared_ptr~Beverage~ beverage)
        +string getDescription() override
        +double cost() override
        -shared_ptr~Beverage~ beverage
    }
    class Whip {
        +Whip(shared_ptr~Beverage~ beverage)
        +string getDescription() override
        -shared_ptr~Beverage~ beverage
    }
    class OtherDecorator {
        +OtherDecorator(shared_ptr~Beverage~ beverage)
        +string getDescription() override
        -shared_ptr~Beverage~ beverage
    }
    CondimentDecorator --|&gt; Beverage
    CondimentDecorator --&gt; Beverage
    Espresso --|&gt; Beverage
    OtherBeverage --|&gt; Beverage
    Mocha --|&gt; CondimentDecorator
    Whip --|&gt; CondimentDecorator
    OtherDecorator --|&gt; CondimentDecorator</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// decorator pattern</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="c1">// component</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="k">virtual</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="n">string</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Unknown Beverage"</span><span class="p">;</span>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="p">};</span>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">Espresso</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="n">Espresso</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Espresso"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">1.99</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="p">};</span>
<a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a>
<a href="#__codelineno-2-25" id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">HouseBlend</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-26" id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-27" id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="n">HouseBlend</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"House Blend Coffee"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-28" id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">.89</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-29" id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="p">};</span>
<a href="#__codelineno-2-30" id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a href="#__codelineno-2-31" id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="k">class</span><span class="w"> </span><span class="nc">DarkRoast</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-32" id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-33" id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="n">DarkRoast</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Dark Roast Coffee"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-34" id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">.99</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-35" id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="p">};</span>
<a href="#__codelineno-2-36" id="__codelineno-2-36" name="__codelineno-2-36"></a>
<a href="#__codelineno-2-37" id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="k">class</span><span class="w"> </span><span class="nc">Decaf</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-38" id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-39" id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="n">Decaf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Decaf Coffee"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-40" id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">1.05</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-41" id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="p">};</span>
<a href="#__codelineno-2-42" id="__codelineno-2-42" name="__codelineno-2-42"></a>
<a href="#__codelineno-2-43" id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="c1">// decorator</span>
<a href="#__codelineno-2-44" id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="k">class</span><span class="w"> </span><span class="nc">CondimentDecorator</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Beverage</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-45" id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-46" id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="k">virtual</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-2-47" id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="p">};</span>
<a href="#__codelineno-2-48" id="__codelineno-2-48" name="__codelineno-2-48"></a>
<a href="#__codelineno-2-49" id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="k">class</span><span class="w"> </span><span class="nc">Mocha</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">CondimentDecorator</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-50" id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-51" id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="n">Mocha</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">beverage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-52" id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="n">string</span><span class="w"> </span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-53" id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", Mocha"</span><span class="p">;</span>
<a href="#__codelineno-2-54" id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="p">}</span>
<a href="#__codelineno-2-55" id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">.20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-56" id="__codelineno-2-56" name="__codelineno-2-56"></a>
<a href="#__codelineno-2-57" id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-2-58" id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span>
<a href="#__codelineno-2-59" id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="p">};</span>
<a href="#__codelineno-2-60" id="__codelineno-2-60" name="__codelineno-2-60"></a>
<a href="#__codelineno-2-61" id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="k">class</span><span class="w"> </span><span class="nc">Whip</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">CondimentDecorator</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-62" id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-63" id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="n">Whip</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">beverage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-64" id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="n">string</span><span class="w"> </span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-65" id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", Whip"</span><span class="p">;</span>
<a href="#__codelineno-2-66" id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="p">}</span>
<a href="#__codelineno-2-67" id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">.10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-68" id="__codelineno-2-68" name="__codelineno-2-68"></a>
<a href="#__codelineno-2-69" id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-2-70" id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span>
<a href="#__codelineno-2-71" id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="p">};</span>
<a href="#__codelineno-2-72" id="__codelineno-2-72" name="__codelineno-2-72"></a>
<a href="#__codelineno-2-73" id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="k">class</span><span class="w"> </span><span class="nc">Soy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">CondimentDecorator</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-74" id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-2-75" id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="n">Soy</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">beverage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-76" id="__codelineno-2-76" name="__codelineno-2-76"></a><span class="n">string</span><span class="w"> </span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-77" id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", Soy"</span><span class="p">;</span>
<a href="#__codelineno-2-78" id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="p">}</span>
<a href="#__codelineno-2-79" id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">.15</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-2-80" id="__codelineno-2-80" name="__codelineno-2-80"></a>
<a href="#__codelineno-2-81" id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-2-82" id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="p">;</span>
<a href="#__codelineno-2-83" id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="p">};</span>
<a href="#__codelineno-2-84" id="__codelineno-2-84" name="__codelineno-2-84"></a>
<a href="#__codelineno-2-85" id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-86" id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Espresso</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-2-87" id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" $"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-2-88" id="__codelineno-2-88" name="__codelineno-2-88"></a>
<a href="#__codelineno-2-89" id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">DarkRoast</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-2-90" id="__codelineno-2-90" name="__codelineno-2-90"></a><span class="n">beverage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Mocha</span><span class="o">&gt;</span><span class="p">(</span><span class="n">beverage2</span><span class="p">);</span>
<a href="#__codelineno-2-91" id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="n">beverage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Whip</span><span class="o">&gt;</span><span class="p">(</span><span class="n">beverage2</span><span class="p">);</span>
<a href="#__codelineno-2-92" id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage2</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" $"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage2</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-2-93" id="__codelineno-2-93" name="__codelineno-2-93"></a>
<a href="#__codelineno-2-94" id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Beverage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beverage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">HouseBlend</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-2-95" id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="n">beverage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Soy</span><span class="o">&gt;</span><span class="p">(</span><span class="n">beverage3</span><span class="p">);</span>
<a href="#__codelineno-2-96" id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="n">beverage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Mocha</span><span class="o">&gt;</span><span class="p">(</span><span class="n">beverage3</span><span class="p">);</span>
<a href="#__codelineno-2-97" id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="n">beverage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Whip</span><span class="o">&gt;</span><span class="p">(</span><span class="n">beverage3</span><span class="p">);</span>
<a href="#__codelineno-2-98" id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage3</span><span class="o">-&gt;</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" $"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">beverage3</span><span class="o">-&gt;</span><span class="n">cost</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-2-99" id="__codelineno-2-99" name="__codelineno-2-99"></a>
<a href="#__codelineno-2-100" id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-2-101" id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="p">}</span>
</code></pre></div>
</details>
<h3 id="_9">总结<a class="headerlink" href="#_9" title="Permanent link">¶</a></h3>
<p>要点</p>
<ul>
<li>装饰者模式意味着一群装饰者类</li>
<li>装饰者类反映出被装饰的组件类型</li>
<li>装饰者可以在被装饰者的行为之前与/或之后加上自己的行为，甚至取代被装饰者的行为，以达到特定的目的</li>
<li>装饰者一般对组件的客户是透明的，除非客户程序依赖于组件的具体类型</li>
<li>装饰者会导致设计中出现许多小对象，如果过度使用，会让程序变得很复杂</li>
</ul>
<p>设计原则</p>
<ul>
<li>封装变化</li>
<li>多用组合，少用继承</li>
<li>针对接口编程，不针对实现编程</li>
<li>为了交互对象之间的松耦合设计而努力</li>
<li>类应该对扩展开放，对修改关闭</li>
</ul>
<h2 id="_10">工厂模式<a class="headerlink" href="#_10" title="Permanent link">¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">简单工厂（荣誉提名）</p>
<p>简单工厂并不是一个设计模式，而是一种编程习惯。简单工厂是一个类，它根据参数的不同返回不同类的实例，被称为工厂类。</p>
</div>
<h3 id="_11">披萨店订餐系统<a class="headerlink" href="#_11" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>new 的问题</p>
<ul>
<li>当使用“new”时，就是在实例化一个具体类，这样就会导致代码依赖具体类，一旦有变化或拓展，就必须重新打开这段代码进行检查和修改。</li>
<li>应当将实例化具体类的代码从应用中抽离或封装起来，使不会干挂应用的其他部分。</li>
</ul>
</li>
<li>
<p>披萨的准备、烘烤等都可以调用接口。</p>
</li>
<li>
<p>问题在于披萨的种类太多，改动披萨种类就得修改订餐函数。</p>
<ul>
<li>将披萨的定义交给工厂——简单工厂</li>
</ul>
</li>
</ul>
<pre class="mermaid"><code>classDiagram
    class Pizza {
        &lt;&lt; abstract &gt;&gt;
        +virtual prepare() = 0
        +virtual bake() = 0
        +virtual cut() = 0
        +virtual box() = 0
    }
    class CheesePizza {
        +prepare()
        +bake()
        +cut()
        +box()
    }
    class OtherPizza {
        +prepare()
        +bake()
        +cut()
        +box()
    }
    class SimplePizzaFactory {
        +shared_ptr~Pizza~ createPizza(string type)
    }
    class PizzaStore {
        +shared_ptr~Pizza~ orderPizza(string type)
        -SimplePizzaFactory factory
    }

    SimplePizzaFactory --&gt; Pizza
    PizzaStore --&gt; SimplePizzaFactory
    Pizza &lt;|-- CheesePizza
    Pizza &lt;|-- OtherPizza
</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1">// simple facotry</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bake</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cut</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">box</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="p">};</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">CheesePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing Cheese Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="p">}</span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="kt">void</span><span class="w"> </span><span class="n">bake</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Baking Cheese Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting Cheese Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="kt">void</span><span class="w"> </span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Boxing Cheese Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="p">};</span>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a>
<a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="k">class</span><span class="w"> </span><span class="nc">PepperoniPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing Pepperoni Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="p">}</span>
<a href="#__codelineno-3-29" id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="kt">void</span><span class="w"> </span><span class="n">bake</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Baking Pepperoni Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-30" id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting Pepperoni Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-31" id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="kt">void</span><span class="w"> </span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Boxing Pepperoni Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-32" id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="p">};</span>
<a href="#__codelineno-3-33" id="__codelineno-3-33" name="__codelineno-3-33"></a>
<a href="#__codelineno-3-34" id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClamPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-35" id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-36" id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing Clam Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-37" id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="kt">void</span><span class="w"> </span><span class="n">bake</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Baking Clam Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-38" id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting Clam Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-39" id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="kt">void</span><span class="w"> </span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Boxing Clam Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-40" id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="p">};</span>
<a href="#__codelineno-3-41" id="__codelineno-3-41" name="__codelineno-3-41"></a>
<a href="#__codelineno-3-42" id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="k">class</span><span class="w"> </span><span class="nc">VeggiePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-43" id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-44" id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-45" id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing Veggie Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-3-46" id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="p">}</span>
<a href="#__codelineno-3-47" id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="kt">void</span><span class="w"> </span><span class="n">bake</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Baking Veggie Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-48" id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting Veggie Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-49" id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="kt">void</span><span class="w"> </span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Boxing Veggie Pizza"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-3-50" id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="p">};</span>
<a href="#__codelineno-3-51" id="__codelineno-3-51" name="__codelineno-3-51"></a>
<a href="#__codelineno-3-52" id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PizzaType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CHEESE</span><span class="p">,</span><span class="w"> </span><span class="n">PEPPERONI</span><span class="p">,</span><span class="w"> </span><span class="n">CLAM</span><span class="p">,</span><span class="w"> </span><span class="n">VEGGIE</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-3-53" id="__codelineno-3-53" name="__codelineno-3-53"></a>
<a href="#__codelineno-3-54" id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="k">class</span><span class="w"> </span><span class="nc">SimplePizzaFactory</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-55" id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-56" id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-57" id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a href="#__codelineno-3-58" id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-59" id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CHEESE</span><span class="p">:</span>
<a href="#__codelineno-3-60" id="__codelineno-3-60" name="__codelineno-3-60"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CheesePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-3-61" id="__codelineno-3-61" name="__codelineno-3-61"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-3-62" id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">PEPPERONI</span><span class="p">:</span>
<a href="#__codelineno-3-63" id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PepperoniPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-3-64" id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-3-65" id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CLAM</span><span class="p">:</span>
<a href="#__codelineno-3-66" id="__codelineno-3-66" name="__codelineno-3-66"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ClamPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-3-67" id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-3-68" id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">VEGGIE</span><span class="p">:</span>
<a href="#__codelineno-3-69" id="__codelineno-3-69" name="__codelineno-3-69"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">VeggiePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-3-70" id="__codelineno-3-70" name="__codelineno-3-70"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-3-71" id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<a href="#__codelineno-3-72" id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-3-73" id="__codelineno-3-73" name="__codelineno-3-73"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-3-74" id="__codelineno-3-74" name="__codelineno-3-74"></a>
<a href="#__codelineno-3-75" id="__codelineno-3-75" name="__codelineno-3-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-3-76" id="__codelineno-3-76" name="__codelineno-3-76"></a><span class="p">}</span>
<a href="#__codelineno-3-77" id="__codelineno-3-77" name="__codelineno-3-77"></a><span class="p">};</span>
<a href="#__codelineno-3-78" id="__codelineno-3-78" name="__codelineno-3-78"></a>
<a href="#__codelineno-3-79" id="__codelineno-3-79" name="__codelineno-3-79"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-80" id="__codelineno-3-80" name="__codelineno-3-80"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-3-81" id="__codelineno-3-81" name="__codelineno-3-81"></a><span class="n">PizzaStore</span><span class="p">(</span><span class="n">SimplePizzaFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">factory</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-3-82" id="__codelineno-3-82" name="__codelineno-3-82"></a>
<a href="#__codelineno-3-83" id="__codelineno-3-83" name="__codelineno-3-83"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-84" id="__codelineno-3-84" name="__codelineno-3-84"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createPizza</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<a href="#__codelineno-3-85" id="__codelineno-3-85" name="__codelineno-3-85"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">();</span>
<a href="#__codelineno-3-86" id="__codelineno-3-86" name="__codelineno-3-86"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">bake</span><span class="p">();</span>
<a href="#__codelineno-3-87" id="__codelineno-3-87" name="__codelineno-3-87"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">cut</span><span class="p">();</span>
<a href="#__codelineno-3-88" id="__codelineno-3-88" name="__codelineno-3-88"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">box</span><span class="p">();</span>
<a href="#__codelineno-3-89" id="__codelineno-3-89" name="__codelineno-3-89"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-3-90" id="__codelineno-3-90" name="__codelineno-3-90"></a><span class="p">}</span>
<a href="#__codelineno-3-91" id="__codelineno-3-91" name="__codelineno-3-91"></a>
<a href="#__codelineno-3-92" id="__codelineno-3-92" name="__codelineno-3-92"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-3-93" id="__codelineno-3-93" name="__codelineno-3-93"></a><span class="n">SimplePizzaFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a href="#__codelineno-3-94" id="__codelineno-3-94" name="__codelineno-3-94"></a><span class="p">};</span>
<a href="#__codelineno-3-95" id="__codelineno-3-95" name="__codelineno-3-95"></a>
<a href="#__codelineno-3-96" id="__codelineno-3-96" name="__codelineno-3-96"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-97" id="__codelineno-3-97" name="__codelineno-3-97"></a><span class="n">SimplePizzaFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a href="#__codelineno-3-98" id="__codelineno-3-98" name="__codelineno-3-98"></a><span class="n">PizzaStore</span><span class="w"> </span><span class="n">store</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a href="#__codelineno-3-99" id="__codelineno-3-99" name="__codelineno-3-99"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">);</span>
<a href="#__codelineno-3-100" id="__codelineno-3-100" name="__codelineno-3-100"></a><span class="p">}</span>
</code></pre></div>
</details>
<div class="admonition abstract">
<p class="admonition-title">工厂方法</p>
<p>定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个。工厂方法让类把实例化推迟到子类。</p>
</div>
<h3 id="_12">加盟店<a class="headerlink" href="#_12" title="Permanent link">¶</a></h3>
<p>各加盟店需要遵循基本的制作流程，但又想要提供不同风味的披萨。如果按之前“简单工厂”的方式，为每个加盟店写一个工厂类。但这样，加盟店就无法进行自己的改良。我们需要一个框架，把加盟店和创建披萨捆绑在一起，同时又保持一定的弹性。</p>
<p>将创建披萨的方法放在 <code>PizzaStore</code> 中，允许子类对 <code>createPizza</code> 进行重写，从而实现加盟店自行决定披萨的特点</p>
<pre class="mermaid"><code>classDiagram
    class Pizza {
        &lt;&lt; abstract &gt;&gt;
        +virtual prepare() = 0
        +virtual bake() = 0
        +virtual cut() = 0
        +virtual box() = 0
    }
    class NYStyleCheesePizza {
        +prepare()
        +bake()
        +cut()
        +box()
    }
    class OtherStylePizza {
        +prepare()
        +bake()
        +cut()
        +box()
    }
    class PizzaStore {
       &lt;&lt; abstract &gt;&gt;
        +shared_ptr~Pizza~ orderPizza(string type)
        #virtual shared_ptr~Pizza~ createPizza(PizzaType type) = 0
    }
    class NYPizzaStore {
        +shared_ptr~Pizza~ orderPizza(string type)
        #shared_ptr~Pizza~ createPizza(PizzaType type)
    }
    class OtherPizzaStore {
        +shared_ptr~Pizza~ orderPizza(string type)
        #shared_ptr~Pizza~ createPizza(PizzaType type)
    }

    Pizza &lt;|-- NYStyleCheesePizza
    Pizza &lt;|-- OtherStylePizza
    PizzaStore &lt;|-- NYPizzaStore
    PizzaStore &lt;|-- OtherPizzaStore
    NYPizzaStore --&gt; NYStyleCheesePizza
    OtherPizzaStore --&gt; OtherStylePizza
</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// factory method pattern</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="n">string</span><span class="w"> </span><span class="n">dough</span><span class="p">;</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="n">string</span><span class="w"> </span><span class="n">sauce</span><span class="p">;</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">toppings</span><span class="p">;</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Tossing dough..."</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Adding sauce..."</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Adding toppings: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">topping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">toppings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"   "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">topping</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-24" id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-4-25" id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="p">}</span>
<a href="#__codelineno-4-26" id="__codelineno-4-26" name="__codelineno-4-26"></a>
<a href="#__codelineno-4-27" id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">bake</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-28" id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Bake for 25 minutes at 350"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-29" id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="p">}</span>
<a href="#__codelineno-4-30" id="__codelineno-4-30" name="__codelineno-4-30"></a>
<a href="#__codelineno-4-31" id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-32" id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting the pizza into diagonal slices"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-33" id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="p">}</span>
<a href="#__codelineno-4-34" id="__codelineno-4-34" name="__codelineno-4-34"></a>
<a href="#__codelineno-4-35" id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">box</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-36" id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Place pizza in official PizzaStore box"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-37" id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="p">}</span>
<a href="#__codelineno-4-38" id="__codelineno-4-38" name="__codelineno-4-38"></a>
<a href="#__codelineno-4-39" id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="n">string</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-40" id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="p">};</span>
<a href="#__codelineno-4-41" id="__codelineno-4-41" name="__codelineno-4-41"></a>
<a href="#__codelineno-4-42" id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYStyleCheesePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-43" id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-44" id="__codelineno-4-44" name="__codelineno-4-44"></a><span class="n">NYStyleCheesePizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-45" id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NY Style Sauce and Cheese Pizza"</span><span class="p">;</span>
<a href="#__codelineno-4-46" id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="w">    </span><span class="n">dough</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Thin Crust Dough"</span><span class="p">;</span>
<a href="#__codelineno-4-47" id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="w">    </span><span class="n">sauce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Marinara Sauce"</span><span class="p">;</span>
<a href="#__codelineno-4-48" id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="w">    </span><span class="n">toppings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"Grated Reggiano Cheese"</span><span class="p">);</span>
<a href="#__codelineno-4-49" id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="p">}</span>
<a href="#__codelineno-4-50" id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="p">};</span>
<a href="#__codelineno-4-51" id="__codelineno-4-51" name="__codelineno-4-51"></a>
<a href="#__codelineno-4-52" id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYStylePepperoniPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-53" id="__codelineno-4-53" name="__codelineno-4-53"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-54" id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="n">NYStylePepperoniPizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NY Style Pepperoni Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-55" id="__codelineno-4-55" name="__codelineno-4-55"></a><span class="p">};</span>
<a href="#__codelineno-4-56" id="__codelineno-4-56" name="__codelineno-4-56"></a>
<a href="#__codelineno-4-57" id="__codelineno-4-57" name="__codelineno-4-57"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYStyleClamPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-58" id="__codelineno-4-58" name="__codelineno-4-58"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-59" id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="n">NYStyleClamPizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NY Style Clam Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-60" id="__codelineno-4-60" name="__codelineno-4-60"></a><span class="p">};</span>
<a href="#__codelineno-4-61" id="__codelineno-4-61" name="__codelineno-4-61"></a>
<a href="#__codelineno-4-62" id="__codelineno-4-62" name="__codelineno-4-62"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYStyleVeggiePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-63" id="__codelineno-4-63" name="__codelineno-4-63"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-64" id="__codelineno-4-64" name="__codelineno-4-64"></a><span class="n">NYStyleVeggiePizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"NY Style Veggie Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-65" id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="p">};</span>
<a href="#__codelineno-4-66" id="__codelineno-4-66" name="__codelineno-4-66"></a>
<a href="#__codelineno-4-67" id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoStyleCheesePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-68" id="__codelineno-4-68" name="__codelineno-4-68"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-69" id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="n">ChicagoStyleCheesePizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-70" id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Chicago Style Deep Dish Cheese Pizza"</span><span class="p">;</span>
<a href="#__codelineno-4-71" id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="w">    </span><span class="n">dough</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Extra Thick Crust Dough"</span><span class="p">;</span>
<a href="#__codelineno-4-72" id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="w">    </span><span class="n">sauce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Plum Tomato Sauce"</span><span class="p">;</span>
<a href="#__codelineno-4-73" id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="w">    </span><span class="n">toppings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"Shredded Mozzarella Cheese"</span><span class="p">);</span>
<a href="#__codelineno-4-74" id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="p">}</span>
<a href="#__codelineno-4-75" id="__codelineno-4-75" name="__codelineno-4-75"></a>
<a href="#__codelineno-4-76" id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="kt">void</span><span class="w"> </span><span class="n">cut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-77" id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting the pizza into square slices"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-78" id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="p">}</span>
<a href="#__codelineno-4-79" id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="p">};</span>
<a href="#__codelineno-4-80" id="__codelineno-4-80" name="__codelineno-4-80"></a>
<a href="#__codelineno-4-81" id="__codelineno-4-81" name="__codelineno-4-81"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoStylePepperoniPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-82" id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-83" id="__codelineno-4-83" name="__codelineno-4-83"></a><span class="n">ChicagoStylePepperoniPizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Chicago Style Pepperoni Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-84" id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="p">};</span>
<a href="#__codelineno-4-85" id="__codelineno-4-85" name="__codelineno-4-85"></a>
<a href="#__codelineno-4-86" id="__codelineno-4-86" name="__codelineno-4-86"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoStyleClamPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-87" id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-88" id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="n">ChicagoStyleClamPizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Chicago Style Clam Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-89" id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="p">};</span>
<a href="#__codelineno-4-90" id="__codelineno-4-90" name="__codelineno-4-90"></a>
<a href="#__codelineno-4-91" id="__codelineno-4-91" name="__codelineno-4-91"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoStyleVeggiePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-92" id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-93" id="__codelineno-4-93" name="__codelineno-4-93"></a><span class="n">ChicagoStyleVeggiePizza</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Chicago Deep Dish Veggie Pizza"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-4-94" id="__codelineno-4-94" name="__codelineno-4-94"></a><span class="p">};</span>
<a href="#__codelineno-4-95" id="__codelineno-4-95" name="__codelineno-4-95"></a>
<a href="#__codelineno-4-96" id="__codelineno-4-96" name="__codelineno-4-96"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PizzaType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CHEESE</span><span class="p">,</span><span class="w"> </span><span class="n">PEPPERONI</span><span class="p">,</span><span class="w"> </span><span class="n">CLAM</span><span class="p">,</span><span class="w"> </span><span class="n">VEGGIE</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-4-97" id="__codelineno-4-97" name="__codelineno-4-97"></a>
<a href="#__codelineno-4-98" id="__codelineno-4-98" name="__codelineno-4-98"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-99" id="__codelineno-4-99" name="__codelineno-4-99"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-4-100" id="__codelineno-4-100" name="__codelineno-4-100"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-101" id="__codelineno-4-101" name="__codelineno-4-101"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<a href="#__codelineno-4-102" id="__codelineno-4-102" name="__codelineno-4-102"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">();</span>
<a href="#__codelineno-4-103" id="__codelineno-4-103" name="__codelineno-4-103"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">bake</span><span class="p">();</span>
<a href="#__codelineno-4-104" id="__codelineno-4-104" name="__codelineno-4-104"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">cut</span><span class="p">();</span>
<a href="#__codelineno-4-105" id="__codelineno-4-105" name="__codelineno-4-105"></a><span class="w">    </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">box</span><span class="p">();</span>
<a href="#__codelineno-4-106" id="__codelineno-4-106" name="__codelineno-4-106"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-4-107" id="__codelineno-4-107" name="__codelineno-4-107"></a><span class="p">}</span>
<a href="#__codelineno-4-108" id="__codelineno-4-108" name="__codelineno-4-108"></a>
<a href="#__codelineno-4-109" id="__codelineno-4-109" name="__codelineno-4-109"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-4-110" id="__codelineno-4-110" name="__codelineno-4-110"></a><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-4-111" id="__codelineno-4-111" name="__codelineno-4-111"></a><span class="p">};</span>
<a href="#__codelineno-4-112" id="__codelineno-4-112" name="__codelineno-4-112"></a>
<a href="#__codelineno-4-113" id="__codelineno-4-113" name="__codelineno-4-113"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYPizzaStore</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-114" id="__codelineno-4-114" name="__codelineno-4-114"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-4-115" id="__codelineno-4-115" name="__codelineno-4-115"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-116" id="__codelineno-4-116" name="__codelineno-4-116"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a href="#__codelineno-4-117" id="__codelineno-4-117" name="__codelineno-4-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-118" id="__codelineno-4-118" name="__codelineno-4-118"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">NYStyleCheesePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-119" id="__codelineno-4-119" name="__codelineno-4-119"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">PEPPERONI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-120" id="__codelineno-4-120" name="__codelineno-4-120"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">NYStylePepperoniPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-121" id="__codelineno-4-121" name="__codelineno-4-121"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CLAM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-122" id="__codelineno-4-122" name="__codelineno-4-122"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">NYStyleClamPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-123" id="__codelineno-4-123" name="__codelineno-4-123"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">VEGGIE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-124" id="__codelineno-4-124" name="__codelineno-4-124"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">NYStyleVeggiePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-125" id="__codelineno-4-125" name="__codelineno-4-125"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-4-126" id="__codelineno-4-126" name="__codelineno-4-126"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-4-127" id="__codelineno-4-127" name="__codelineno-4-127"></a><span class="p">}</span>
<a href="#__codelineno-4-128" id="__codelineno-4-128" name="__codelineno-4-128"></a><span class="p">};</span>
<a href="#__codelineno-4-129" id="__codelineno-4-129" name="__codelineno-4-129"></a>
<a href="#__codelineno-4-130" id="__codelineno-4-130" name="__codelineno-4-130"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoPizzaStore</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-131" id="__codelineno-4-131" name="__codelineno-4-131"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-4-132" id="__codelineno-4-132" name="__codelineno-4-132"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-133" id="__codelineno-4-133" name="__codelineno-4-133"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a href="#__codelineno-4-134" id="__codelineno-4-134" name="__codelineno-4-134"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-135" id="__codelineno-4-135" name="__codelineno-4-135"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ChicagoStyleCheesePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-136" id="__codelineno-4-136" name="__codelineno-4-136"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">PEPPERONI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-137" id="__codelineno-4-137" name="__codelineno-4-137"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ChicagoStylePepperoniPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-138" id="__codelineno-4-138" name="__codelineno-4-138"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CLAM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-139" id="__codelineno-4-139" name="__codelineno-4-139"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ChicagoStyleClamPizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-140" id="__codelineno-4-140" name="__codelineno-4-140"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PizzaType</span><span class="o">::</span><span class="n">VEGGIE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-141" id="__codelineno-4-141" name="__codelineno-4-141"></a><span class="w">    </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ChicagoStyleVeggiePizza</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-142" id="__codelineno-4-142" name="__codelineno-4-142"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-4-143" id="__codelineno-4-143" name="__codelineno-4-143"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-4-144" id="__codelineno-4-144" name="__codelineno-4-144"></a><span class="p">}</span>
<a href="#__codelineno-4-145" id="__codelineno-4-145" name="__codelineno-4-145"></a><span class="p">};</span>
<a href="#__codelineno-4-146" id="__codelineno-4-146" name="__codelineno-4-146"></a>
<a href="#__codelineno-4-147" id="__codelineno-4-147" name="__codelineno-4-147"></a>
<a href="#__codelineno-4-148" id="__codelineno-4-148" name="__codelineno-4-148"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-149" id="__codelineno-4-149" name="__codelineno-4-149"></a><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">PizzaStore</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nyStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">NYPizzaStore</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-150" id="__codelineno-4-150" name="__codelineno-4-150"></a><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">PizzaStore</span><span class="o">&gt;</span><span class="w"> </span><span class="n">chicagoStore</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-4-151" id="__codelineno-4-151" name="__codelineno-4-151"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ChicagoPizzaStore</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-4-152" id="__codelineno-4-152" name="__codelineno-4-152"></a>
<a href="#__codelineno-4-153" id="__codelineno-4-153" name="__codelineno-4-153"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nyStore</span><span class="o">-&gt;</span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">);</span>
<a href="#__codelineno-4-154" id="__codelineno-4-154" name="__codelineno-4-154"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Ethan ordered a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-155" id="__codelineno-4-155" name="__codelineno-4-155"></a>
<a href="#__codelineno-4-156" id="__codelineno-4-156" name="__codelineno-4-156"></a><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chicagoStore</span><span class="o">-&gt;</span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">);</span>
<a href="#__codelineno-4-157" id="__codelineno-4-157" name="__codelineno-4-157"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Joel ordered a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-4-158" id="__codelineno-4-158" name="__codelineno-4-158"></a>
<a href="#__codelineno-4-159" id="__codelineno-4-159" name="__codelineno-4-159"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-4-160" id="__codelineno-4-160" name="__codelineno-4-160"></a><span class="p">}</span>
</code></pre></div>
</details>
<div class="admonition abstract">
<p class="admonition-title">抽象工厂</p>
<p>提供一个接口，用于创建相关或依赖对象的家庭。</p>
</div>
<h3 id="_13">原料工厂<a class="headerlink" href="#_13" title="Permanent link">¶</a></h3>
<p>各个加盟店使用的原料参差不齐，我们需要使用统一供应的原料。
不同的加盟店可能使用不同的原料。我们要建造一个原料工厂，用于生产原料。</p>
<p>让工厂负责创建原料家庭中的每一种原料：面团、酱料、芝士等等。
不同的披萨店只需要从原料工厂获取特定风味的原料就行。</p>
<pre class="mermaid"><code>classDiagram
    class Pizza {
        &lt;&lt; abstract &gt;&gt;
        +virtual prepare() = 0
        +virtual bake() = 0
        +virtual cut() = 0
        +virtual box() = 0
    }
    class CheesePizza {
        +prepare()
        +bake()
        +cut()
        +box()
        -PizzaIngredientFactory ingredientFactory
    }
    class Dough {
    }
    class Sauce {
    }
    class Cheese {
    }
    class Pepperoni {
    }
    class Clams {
    }
    class Veggies {
    }
    class PizzaIngredientFactory {
        &lt;&lt; abstract &gt;&gt;
        +virtual shared_ptr~Dough~ createDough() =0
        +virtual shared_ptr~Sauce~ createSauce() =0
        +virtual shared_ptr~Cheese~ createCheese() =0
        +virtual shared_ptr~Pepperoni~ createPepperoni() =0
        +virtual shared_ptr~Clams~ createClams() =0
        +virtual vector~shared_ptr~Veggies~~ createVeggies() =0
    }
    class NYPizzaIngredientFactory {
        +shared_ptr~Dough~ createDough() override
        +shared_ptr~Sauce~ createSauce() override
        +shared_ptr~Cheese~ createCheese() override
        +shared_ptr~Pepperoni~ createPepperoni() override
        +shared_ptr~Clams~ createClams() override
        +vector~shared_ptr~Veggies~~ createVeggies() override
    }

    PizzaIngredientFactory --&gt; Dough
    PizzaIngredientFactory --&gt; Sauce
    PizzaIngredientFactory --&gt; Cheese
    PizzaIngredientFactory --&gt; Pepperoni
    PizzaIngredientFactory --&gt; Clams
    PizzaIngredientFactory --&gt; Veggies
    NYPizzaIngredientFactory --|&gt; PizzaIngredientFactory
    Pizza &lt;|-- CheesePizza</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">// abstract factory pattern</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">Dough</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Sauce</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Cheese</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pepperoni</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">Clams</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Garlic</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Onion</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">Mushroom</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">RedPepper</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">BlackOlives</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">Spinach</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">EggPlant</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Veggies</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a>
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzaIngredientFactory</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-25" id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="k">virtual</span><span class="w"> </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Dough</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createDough</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-26" id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="k">virtual</span><span class="w"> </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Sauce</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createSauce</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-27" id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="k">virtual</span><span class="w"> </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Cheese</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createCheese</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-28" id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="k">virtual</span><span class="w"> </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pepperoni</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPepperoni</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-29" id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="k">virtual</span><span class="w"> </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Clams</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createClams</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-30" id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="k">virtual</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">createVeggies</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-31" id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="p">};</span>
<a href="#__codelineno-5-32" id="__codelineno-5-32" name="__codelineno-5-32"></a>
<a href="#__codelineno-5-33" id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="c1">//</span>
<a href="#__codelineno-5-34" id="__codelineno-5-34" name="__codelineno-5-34"></a>
<a href="#__codelineno-5-35" id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThinCrustDough</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Dough</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-36" id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="k">class</span><span class="w"> </span><span class="nc">MarinaraSauce</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Sauce</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-37" id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="k">class</span><span class="w"> </span><span class="nc">ReggianoCheese</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Cheese</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-38" id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="k">class</span><span class="w"> </span><span class="nc">SlicedPepperoni</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pepperoni</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-39" id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="k">class</span><span class="w"> </span><span class="nc">FreshClams</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Clams</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-40" id="__codelineno-5-40" name="__codelineno-5-40"></a>
<a href="#__codelineno-5-41" id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYPizzaIngredientFactory</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaIngredientFactory</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-42" id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-43" id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Dough</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createDough</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-44" id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ThinCrustDough</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-45" id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="p">}</span>
<a href="#__codelineno-5-46" id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Sauce</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createSauce</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-47" id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MarinaraSauce</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-48" id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="p">}</span>
<a href="#__codelineno-5-49" id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Cheese</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createCheese</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-50" id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ReggianoCheese</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-51" id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="p">}</span>
<a href="#__codelineno-5-52" id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pepperoni</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPepperoni</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-53" id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SlicedPepperoni</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-54" id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="p">}</span>
<a href="#__codelineno-5-55" id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Clams</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createClams</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">FreshClams</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-5-56" id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">createVeggies</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-57" id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">veggies</span><span class="p">;</span>
<a href="#__codelineno-5-58" id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Garlic</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-59" id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Onion</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-60" id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Mushroom</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-61" id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">RedPepper</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-62" id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">veggies</span><span class="p">;</span>
<a href="#__codelineno-5-63" id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="p">}</span>
<a href="#__codelineno-5-64" id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="p">};</span>
<a href="#__codelineno-5-65" id="__codelineno-5-65" name="__codelineno-5-65"></a>
<a href="#__codelineno-5-66" id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThickCrustDough</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Dough</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-67" id="__codelineno-5-67" name="__codelineno-5-67"></a><span class="k">class</span><span class="w"> </span><span class="nc">PlumTomatoSauce</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Sauce</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-68" id="__codelineno-5-68" name="__codelineno-5-68"></a><span class="k">class</span><span class="w"> </span><span class="nc">MozzarellaCheese</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Cheese</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-69" id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="k">class</span><span class="w"> </span><span class="nc">FrozenClams</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Clams</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-5-70" id="__codelineno-5-70" name="__codelineno-5-70"></a>
<a href="#__codelineno-5-71" id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoPizzaIngredientFactory</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaIngredientFactory</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-72" id="__codelineno-5-72" name="__codelineno-5-72"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-73" id="__codelineno-5-73" name="__codelineno-5-73"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Dough</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createDough</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-74" id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ThickCrustDough</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-75" id="__codelineno-5-75" name="__codelineno-5-75"></a><span class="p">}</span>
<a href="#__codelineno-5-76" id="__codelineno-5-76" name="__codelineno-5-76"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Sauce</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createSauce</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-77" id="__codelineno-5-77" name="__codelineno-5-77"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PlumTomatoSauce</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-78" id="__codelineno-5-78" name="__codelineno-5-78"></a><span class="p">}</span>
<a href="#__codelineno-5-79" id="__codelineno-5-79" name="__codelineno-5-79"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Cheese</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createCheese</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-80" id="__codelineno-5-80" name="__codelineno-5-80"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MozzarellaCheese</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-81" id="__codelineno-5-81" name="__codelineno-5-81"></a><span class="p">}</span>
<a href="#__codelineno-5-82" id="__codelineno-5-82" name="__codelineno-5-82"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pepperoni</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPepperoni</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-83" id="__codelineno-5-83" name="__codelineno-5-83"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SlicedPepperoni</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-84" id="__codelineno-5-84" name="__codelineno-5-84"></a><span class="p">}</span>
<a href="#__codelineno-5-85" id="__codelineno-5-85" name="__codelineno-5-85"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Clams</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createClams</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-86" id="__codelineno-5-86" name="__codelineno-5-86"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">FrozenClams</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-87" id="__codelineno-5-87" name="__codelineno-5-87"></a><span class="p">}</span>
<a href="#__codelineno-5-88" id="__codelineno-5-88" name="__codelineno-5-88"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">createVeggies</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-89" id="__codelineno-5-89" name="__codelineno-5-89"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">veggies</span><span class="p">;</span>
<a href="#__codelineno-5-90" id="__codelineno-5-90" name="__codelineno-5-90"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">BlackOlives</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-91" id="__codelineno-5-91" name="__codelineno-5-91"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Spinach</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-92" id="__codelineno-5-92" name="__codelineno-5-92"></a><span class="w">    </span><span class="n">veggies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">EggPlant</span><span class="o">&gt;</span><span class="p">());</span>
<a href="#__codelineno-5-93" id="__codelineno-5-93" name="__codelineno-5-93"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">veggies</span><span class="p">;</span>
<a href="#__codelineno-5-94" id="__codelineno-5-94" name="__codelineno-5-94"></a><span class="p">}</span>
<a href="#__codelineno-5-95" id="__codelineno-5-95" name="__codelineno-5-95"></a><span class="p">};</span>
<a href="#__codelineno-5-96" id="__codelineno-5-96" name="__codelineno-5-96"></a>
<a href="#__codelineno-5-97" id="__codelineno-5-97" name="__codelineno-5-97"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-98" id="__codelineno-5-98" name="__codelineno-5-98"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-99" id="__codelineno-5-99" name="__codelineno-5-99"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-5-100" id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bake</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Bake for 25 minutes at 350"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-5-101" id="__codelineno-5-101" name="__codelineno-5-101"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-102" id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cutting the pizza into diagonal slices"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-103" id="__codelineno-5-103" name="__codelineno-5-103"></a><span class="p">}</span>
<a href="#__codelineno-5-104" id="__codelineno-5-104" name="__codelineno-5-104"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">box</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-105" id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Place pizza in official PizzaStore box"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-106" id="__codelineno-5-106" name="__codelineno-5-106"></a><span class="p">}</span>
<a href="#__codelineno-5-107" id="__codelineno-5-107" name="__codelineno-5-107"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setName</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-5-108" id="__codelineno-5-108" name="__codelineno-5-108"></a><span class="n">string</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-5-109" id="__codelineno-5-109" name="__codelineno-5-109"></a><span class="n">string</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-110" id="__codelineno-5-110" name="__codelineno-5-110"></a><span class="w">    </span><span class="c1">// code to display pizza name and ingredients</span>
<a href="#__codelineno-5-111" id="__codelineno-5-111" name="__codelineno-5-111"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
<a href="#__codelineno-5-112" id="__codelineno-5-112" name="__codelineno-5-112"></a><span class="p">}</span>
<a href="#__codelineno-5-113" id="__codelineno-5-113" name="__codelineno-5-113"></a>
<a href="#__codelineno-5-114" id="__codelineno-5-114" name="__codelineno-5-114"></a><span class="k">protected</span><span class="o">:</span>
<a href="#__codelineno-5-115" id="__codelineno-5-115" name="__codelineno-5-115"></a><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a href="#__codelineno-5-116" id="__codelineno-5-116" name="__codelineno-5-116"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Dough</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dough</span><span class="p">;</span>
<a href="#__codelineno-5-117" id="__codelineno-5-117" name="__codelineno-5-117"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Sauce</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sauce</span><span class="p">;</span>
<a href="#__codelineno-5-118" id="__codelineno-5-118" name="__codelineno-5-118"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Cheese</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cheese</span><span class="p">;</span>
<a href="#__codelineno-5-119" id="__codelineno-5-119" name="__codelineno-5-119"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pepperoni</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pepperoni</span><span class="p">;</span>
<a href="#__codelineno-5-120" id="__codelineno-5-120" name="__codelineno-5-120"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Clams</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clams</span><span class="p">;</span>
<a href="#__codelineno-5-121" id="__codelineno-5-121" name="__codelineno-5-121"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Veggies</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">veggies</span><span class="p">;</span>
<a href="#__codelineno-5-122" id="__codelineno-5-122" name="__codelineno-5-122"></a><span class="p">};</span>
<a href="#__codelineno-5-123" id="__codelineno-5-123" name="__codelineno-5-123"></a>
<a href="#__codelineno-5-124" id="__codelineno-5-124" name="__codelineno-5-124"></a><span class="k">class</span><span class="w"> </span><span class="nc">CheesePizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-125" id="__codelineno-5-125" name="__codelineno-5-125"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-126" id="__codelineno-5-126" name="__codelineno-5-126"></a><span class="n">CheesePizza</span><span class="p">(</span><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-127" id="__codelineno-5-127" name="__codelineno-5-127"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">ingredientFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">;</span>
<a href="#__codelineno-5-128" id="__codelineno-5-128" name="__codelineno-5-128"></a><span class="p">}</span>
<a href="#__codelineno-5-129" id="__codelineno-5-129" name="__codelineno-5-129"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-130" id="__codelineno-5-130" name="__codelineno-5-130"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-131" id="__codelineno-5-131" name="__codelineno-5-131"></a><span class="w">    </span><span class="n">dough</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createDough</span><span class="p">();</span>
<a href="#__codelineno-5-132" id="__codelineno-5-132" name="__codelineno-5-132"></a><span class="w">    </span><span class="n">sauce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createSauce</span><span class="p">();</span>
<a href="#__codelineno-5-133" id="__codelineno-5-133" name="__codelineno-5-133"></a><span class="w">    </span><span class="n">cheese</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createCheese</span><span class="p">();</span>
<a href="#__codelineno-5-134" id="__codelineno-5-134" name="__codelineno-5-134"></a><span class="p">}</span>
<a href="#__codelineno-5-135" id="__codelineno-5-135" name="__codelineno-5-135"></a>
<a href="#__codelineno-5-136" id="__codelineno-5-136" name="__codelineno-5-136"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-5-137" id="__codelineno-5-137" name="__codelineno-5-137"></a><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">;</span>
<a href="#__codelineno-5-138" id="__codelineno-5-138" name="__codelineno-5-138"></a><span class="p">};</span>
<a href="#__codelineno-5-139" id="__codelineno-5-139" name="__codelineno-5-139"></a>
<a href="#__codelineno-5-140" id="__codelineno-5-140" name="__codelineno-5-140"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClamPizza</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Pizza</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-141" id="__codelineno-5-141" name="__codelineno-5-141"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-142" id="__codelineno-5-142" name="__codelineno-5-142"></a><span class="n">ClamPizza</span><span class="p">(</span><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-143" id="__codelineno-5-143" name="__codelineno-5-143"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">ingredientFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">;</span>
<a href="#__codelineno-5-144" id="__codelineno-5-144" name="__codelineno-5-144"></a><span class="p">}</span>
<a href="#__codelineno-5-145" id="__codelineno-5-145" name="__codelineno-5-145"></a><span class="kt">void</span><span class="w"> </span><span class="n">prepare</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-146" id="__codelineno-5-146" name="__codelineno-5-146"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Preparing "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-147" id="__codelineno-5-147" name="__codelineno-5-147"></a><span class="w">    </span><span class="n">dough</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createDough</span><span class="p">();</span>
<a href="#__codelineno-5-148" id="__codelineno-5-148" name="__codelineno-5-148"></a><span class="w">    </span><span class="n">sauce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createSauce</span><span class="p">();</span>
<a href="#__codelineno-5-149" id="__codelineno-5-149" name="__codelineno-5-149"></a><span class="w">    </span><span class="n">cheese</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createCheese</span><span class="p">();</span>
<a href="#__codelineno-5-150" id="__codelineno-5-150" name="__codelineno-5-150"></a><span class="w">    </span><span class="n">clams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="o">-&gt;</span><span class="n">createClams</span><span class="p">();</span>
<a href="#__codelineno-5-151" id="__codelineno-5-151" name="__codelineno-5-151"></a><span class="p">}</span>
<a href="#__codelineno-5-152" id="__codelineno-5-152" name="__codelineno-5-152"></a>
<a href="#__codelineno-5-153" id="__codelineno-5-153" name="__codelineno-5-153"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-5-154" id="__codelineno-5-154" name="__codelineno-5-154"></a><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="p">;</span>
<a href="#__codelineno-5-155" id="__codelineno-5-155" name="__codelineno-5-155"></a><span class="p">};</span>
<a href="#__codelineno-5-156" id="__codelineno-5-156" name="__codelineno-5-156"></a>
<a href="#__codelineno-5-157" id="__codelineno-5-157" name="__codelineno-5-157"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PizzaType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CHEESE</span><span class="p">,</span><span class="w"> </span><span class="n">CLAM</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-5-158" id="__codelineno-5-158" name="__codelineno-5-158"></a>
<a href="#__codelineno-5-159" id="__codelineno-5-159" name="__codelineno-5-159"></a><span class="k">class</span><span class="w"> </span><span class="nc">NYPizzaStore</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-160" id="__codelineno-5-160" name="__codelineno-5-160"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-161" id="__codelineno-5-161" name="__codelineno-5-161"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-162" id="__codelineno-5-162" name="__codelineno-5-162"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a href="#__codelineno-5-163" id="__codelineno-5-163" name="__codelineno-5-163"></a><span class="w">    </span><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NYPizzaIngredientFactory</span><span class="p">();</span>
<a href="#__codelineno-5-164" id="__codelineno-5-164" name="__codelineno-5-164"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-165" id="__codelineno-5-165" name="__codelineno-5-165"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CHEESE</span><span class="p">:</span>
<a href="#__codelineno-5-166" id="__codelineno-5-166" name="__codelineno-5-166"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CheesePizza</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ingredientFactory</span><span class="p">);</span>
<a href="#__codelineno-5-167" id="__codelineno-5-167" name="__codelineno-5-167"></a><span class="w">        </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">setName</span><span class="p">(</span><span class="s">"New York Style Cheese Pizza"</span><span class="p">);</span>
<a href="#__codelineno-5-168" id="__codelineno-5-168" name="__codelineno-5-168"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-5-169" id="__codelineno-5-169" name="__codelineno-5-169"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CLAM</span><span class="p">:</span>
<a href="#__codelineno-5-170" id="__codelineno-5-170" name="__codelineno-5-170"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ClamPizza</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ingredientFactory</span><span class="p">);</span>
<a href="#__codelineno-5-171" id="__codelineno-5-171" name="__codelineno-5-171"></a><span class="w">        </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">setName</span><span class="p">(</span><span class="s">"New York Style Clam Pizza"</span><span class="p">);</span>
<a href="#__codelineno-5-172" id="__codelineno-5-172" name="__codelineno-5-172"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-5-173" id="__codelineno-5-173" name="__codelineno-5-173"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-5-174" id="__codelineno-5-174" name="__codelineno-5-174"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-5-175" id="__codelineno-5-175" name="__codelineno-5-175"></a><span class="p">}</span>
<a href="#__codelineno-5-176" id="__codelineno-5-176" name="__codelineno-5-176"></a><span class="p">};</span>
<a href="#__codelineno-5-177" id="__codelineno-5-177" name="__codelineno-5-177"></a>
<a href="#__codelineno-5-178" id="__codelineno-5-178" name="__codelineno-5-178"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChicagoPizzaStore</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PizzaStore</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-179" id="__codelineno-5-179" name="__codelineno-5-179"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-5-180" id="__codelineno-5-180" name="__codelineno-5-180"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-181" id="__codelineno-5-181" name="__codelineno-5-181"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a href="#__codelineno-5-182" id="__codelineno-5-182" name="__codelineno-5-182"></a><span class="w">    </span><span class="n">PizzaIngredientFactory</span><span class="o">*</span><span class="w"> </span><span class="n">ingredientFactory</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-5-183" id="__codelineno-5-183" name="__codelineno-5-183"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ChicagoPizzaIngredientFactory</span><span class="p">();</span>
<a href="#__codelineno-5-184" id="__codelineno-5-184" name="__codelineno-5-184"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-185" id="__codelineno-5-185" name="__codelineno-5-185"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CHEESE</span><span class="p">:</span>
<a href="#__codelineno-5-186" id="__codelineno-5-186" name="__codelineno-5-186"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CheesePizza</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ingredientFactory</span><span class="p">);</span>
<a href="#__codelineno-5-187" id="__codelineno-5-187" name="__codelineno-5-187"></a><span class="w">        </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">setName</span><span class="p">(</span><span class="s">"Chicago Style Cheese Pizza"</span><span class="p">);</span>
<a href="#__codelineno-5-188" id="__codelineno-5-188" name="__codelineno-5-188"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-5-189" id="__codelineno-5-189" name="__codelineno-5-189"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PizzaType</span><span class="o">::</span><span class="no">CLAM</span><span class="p">:</span>
<a href="#__codelineno-5-190" id="__codelineno-5-190" name="__codelineno-5-190"></a><span class="w">        </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ClamPizza</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ingredientFactory</span><span class="p">);</span>
<a href="#__codelineno-5-191" id="__codelineno-5-191" name="__codelineno-5-191"></a><span class="w">        </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">setName</span><span class="p">(</span><span class="s">"Chicago Style Clam Pizza"</span><span class="p">);</span>
<a href="#__codelineno-5-192" id="__codelineno-5-192" name="__codelineno-5-192"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-5-193" id="__codelineno-5-193" name="__codelineno-5-193"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-5-194" id="__codelineno-5-194" name="__codelineno-5-194"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pizza</span><span class="p">;</span>
<a href="#__codelineno-5-195" id="__codelineno-5-195" name="__codelineno-5-195"></a><span class="p">}</span>
<a href="#__codelineno-5-196" id="__codelineno-5-196" name="__codelineno-5-196"></a><span class="p">};</span>
<a href="#__codelineno-5-197" id="__codelineno-5-197" name="__codelineno-5-197"></a>
<a href="#__codelineno-5-198" id="__codelineno-5-198" name="__codelineno-5-198"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-199" id="__codelineno-5-199" name="__codelineno-5-199"></a><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">PizzaStore</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nyStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">NYPizzaStore</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-200" id="__codelineno-5-200" name="__codelineno-5-200"></a><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">PizzaStore</span><span class="o">&gt;</span><span class="w"> </span><span class="n">chicagoStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ChicagoPizzaStore</span><span class="o">&gt;</span><span class="p">();</span>
<a href="#__codelineno-5-201" id="__codelineno-5-201" name="__codelineno-5-201"></a>
<a href="#__codelineno-5-202" id="__codelineno-5-202" name="__codelineno-5-202"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pizza</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nyStore</span><span class="o">-&gt;</span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CHEESE</span><span class="p">);</span>
<a href="#__codelineno-5-203" id="__codelineno-5-203" name="__codelineno-5-203"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Ethan ordered a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-204" id="__codelineno-5-204" name="__codelineno-5-204"></a>
<a href="#__codelineno-5-205" id="__codelineno-5-205" name="__codelineno-5-205"></a><span class="n">pizza</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chicagoStore</span><span class="o">-&gt;</span><span class="n">orderPizza</span><span class="p">(</span><span class="n">PizzaType</span><span class="o">::</span><span class="n">CLAM</span><span class="p">);</span>
<a href="#__codelineno-5-206" id="__codelineno-5-206" name="__codelineno-5-206"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Joel ordered a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pizza</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-5-207" id="__codelineno-5-207" name="__codelineno-5-207"></a><span class="p">}</span>
</code></pre></div>
</details>
<h3 id="_14">总结<a class="headerlink" href="#_14" title="Permanent link">¶</a></h3>
<p>要点</p>
<ul>
<li>工厂方法让子类决定要实例化的类是哪一个</li>
<li>工厂方法使用继承</li>
<li>工厂方法允许类将实例化延迟到子类进行</li>
<li>参数化工厂方法中参数错误的问题可以通过，创建代表参数类型的对象和作用静态常量，或者枚举的方法解决</li>
<li>抽象工厂允许客户使用抽象的接口来创建一组相关的产品，而不需要知道（或关心）实际产出的具体产品是什么。这样一来，客户就从具体的产品中被解耦</li>
<li>抽象工厂使用对象组合</li>
<li>抽象工厂创建相关的对象家族，而不需要依赖它们的具体类</li>
</ul>
<p>设计原则</p>
<ul>
<li>多用组合，少用继承</li>
<li>针对接口编程，不针对实现编程</li>
<li>为了交互对象之间的松耦合设计而努力</li>
<li>类应该对扩展开放，对修改关闭</li>
<li>
<p>要依赖抽象，不要依赖具体类</p>
<ul>
<li>
<p>依赖倒置原则</p>
<ul>
<li>变量不可以持有具体类的引用</li>
<li>不要让类派生自具体类</li>
<li>不要覆盖基类中已实现的方法</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="_15">单例模式<a class="headerlink" href="#_15" title="Permanent link">¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">单例模式</p>
<p>确保一个类只有一个实例，并提供一个全局访问点。</p>
</div>
<h3 id="_16">巧克力工厂<a class="headerlink" href="#_16" title="Permanent link">¶</a></h3>
<p>单例模式适用情景</p>
<ul>
<li>线程池</li>
<li>缓存</li>
<li>对话框</li>
<li>偏好设置</li>
<li>注册表</li>
<li>日志</li>
<li>驱动</li>
</ul>
<p>全局变量的缺点</p>
<ul>
<li>需要的时候才创建对象，单例可以延迟实例化</li>
</ul>
<p>经典的单例模式实现</p>
<ul>
<li>利用一个静态变量记录单例类的唯一实例</li>
<li>声明类的构造器为私有的，只有单例类内部才可以调用</li>
<li>用静态的方法实例化对象，并返回这个实例</li>
</ul>
<p>如何处理多线程？</p>
<ul>
<li>
<p>只需要将那个获取单例静态方法 getInstance() 改为同步方法</p>
<p>然而，我们只需要在实例化的那次才需要同步，后面再同步只是累赘</p>
</li>
<li>
<p>getInstance() 性能不是关键，就不用管有什么额外负担</p>
</li>
<li>
<p>如果 getInstance() 调用很频繁，就得重新考虑了</p>
<ul>
<li>
<p>使用“急切”创建实例</p>
<p>如果应用程序总是创建并使用单例实例，或者在创建和运行时方面的负担不太繁重，就可以在静态变量初始化时创建单例</p>
</li>
<li>
<p>使用“双重检查加锁”，减少使用同步</p>
<p>先检查单例是否存在，然后再进入同步代码
需要使用 volatile 关键字</p>
</li>
</ul>
</li>
</ul>
<p>在 《Effective C++》的条款 4 中，提到了一个更好的方法，即静态局部变量，它的特点是</p>
<ul>
<li>仅当程序第一次执行到 <code>GetInstance</code> 函数时，执行 <code>instance</code> 对象的初始化；</li>
<li>在 C++ 11 之后，被 <code>static</code> 修饰的变量可以保证是线程安全的；</li>
</ul>
<p>同时，我们删除了拷贝构造函数和赋值操作符。</p>
<pre class="mermaid"><code>classDiagram
    class ChocolateBoiler {
        -bool empty
        -bool boiled
        -ChocolateBoiler()
        -ChocolateBoiler(const ChocolateBoiler &amp;) = delete;
        -ChocolateBoiler &amp;operator=(const ChocolateBoiler &amp;) = delete;
        +static ChocolateBoiler &amp;getInstance()
        +void fill()
        +void drain()
        +void boil()
        +bool isEmpty()
        +bool isBoiled()
    }</code></pre>
<details class="caution">
<summary>代码拿来</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1">// Singleton</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChocolateBoiler</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="k">private</span><span class="o">:</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="kt">bool</span><span class="w"> </span><span class="n">empty</span><span class="p">;</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kt">bool</span><span class="w"> </span><span class="n">boiled</span><span class="p">;</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="n">ChocolateBoiler</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">empty</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span><span class="w"> </span><span class="n">boiled</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Creating unique instance of Chocolate Boiler"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="p">}</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="k">public</span><span class="o">:</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="n">ChocolateBoiler</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="c1">// best of all, from effective c++ item 4</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="k">static</span><span class="w"> </span><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">getInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="p">}</span>
<a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a>
<a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="kt">void</span><span class="w"> </span><span class="nf">fill</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-26" id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-27" id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">    </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a href="#__codelineno-6-28" id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">    </span><span class="n">boiled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a href="#__codelineno-6-29" id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">    </span><span class="c1">// fill the boiler with a milk/chocolate mixture</span>
<a href="#__codelineno-6-30" id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-6-31" id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="p">}</span>
<a href="#__codelineno-6-32" id="__codelineno-6-32" name="__codelineno-6-32"></a>
<a href="#__codelineno-6-33" id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="kt">void</span><span class="w"> </span><span class="nf">drain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-34" id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isBoiled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-35" id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">    </span><span class="c1">// drain the boiled milk and chocolate</span>
<a href="#__codelineno-6-36" id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">    </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a href="#__codelineno-6-37" id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-6-38" id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="p">}</span>
<a href="#__codelineno-6-39" id="__codelineno-6-39" name="__codelineno-6-39"></a>
<a href="#__codelineno-6-40" id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="kt">void</span><span class="w"> </span><span class="nf">boil</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-41" id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isBoiled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-42" id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="w">    </span><span class="c1">// bring the contents to a boil</span>
<a href="#__codelineno-6-43" id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="w">    </span><span class="n">boiled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a href="#__codelineno-6-44" id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-6-45" id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="p">}</span>
<a href="#__codelineno-6-46" id="__codelineno-6-46" name="__codelineno-6-46"></a>
<a href="#__codelineno-6-47" id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">empty</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-6-48" id="__codelineno-6-48" name="__codelineno-6-48"></a>
<a href="#__codelineno-6-49" id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">isBoiled</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">boiled</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-6-50" id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="p">};</span>
<a href="#__codelineno-6-51" id="__codelineno-6-51" name="__codelineno-6-51"></a>
<a href="#__codelineno-6-52" id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mtx</span><span class="p">;</span>
<a href="#__codelineno-6-53" id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">cv</span><span class="p">;</span>
<a href="#__codelineno-6-54" id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="kt">bool</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a href="#__codelineno-6-55" id="__codelineno-6-55" name="__codelineno-6-55"></a>
<a href="#__codelineno-6-56" id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="kt">void</span><span class="w"> </span><span class="nf">runChocolateBoiler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-57" id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="n">ChocolateBoiler</span><span class="w"> </span><span class="o">&amp;</span><span class="n">boiler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChocolateBoiler</span><span class="o">::</span><span class="n">getInstance</span><span class="p">();</span>
<a href="#__codelineno-6-58" id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="n">boiler</span><span class="p">.</span><span class="n">fill</span><span class="p">();</span>
<a href="#__codelineno-6-59" id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="n">boiler</span><span class="p">.</span><span class="n">boil</span><span class="p">();</span>
<a href="#__codelineno-6-60" id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="n">boiler</span><span class="p">.</span><span class="n">drain</span><span class="p">();</span>
<a href="#__codelineno-6-61" id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="p">}</span>
<a href="#__codelineno-6-62" id="__codelineno-6-62" name="__codelineno-6-62"></a>
<a href="#__codelineno-6-63" id="__codelineno-6-63" name="__codelineno-6-63"></a><span class="kt">void</span><span class="w"> </span><span class="nf">threadStart</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-64" id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lck</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span>
<a href="#__codelineno-6-65" id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a href="#__codelineno-6-66" id="__codelineno-6-66" name="__codelineno-6-66"></a><span class="n">cv</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span>
<a href="#__codelineno-6-67" id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="p">}</span>
<a href="#__codelineno-6-68" id="__codelineno-6-68" name="__codelineno-6-68"></a>
<a href="#__codelineno-6-69" id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-70" id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="c1">// test singleton in 10 threads</span>
<a href="#__codelineno-6-71" id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">threads</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<a href="#__codelineno-6-72" id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="c1">// spawn 10 threads:</span>
<a href="#__codelineno-6-73" id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a href="#__codelineno-6-74" id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="w">    </span><span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="n">runChocolateBoiler</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a href="#__codelineno-6-75" id="__codelineno-6-75" name="__codelineno-6-75"></a>
<a href="#__codelineno-6-76" id="__codelineno-6-76" name="__codelineno-6-76"></a><span class="n">threadStart</span><span class="p">();</span>
<a href="#__codelineno-6-77" id="__codelineno-6-77" name="__codelineno-6-77"></a>
<a href="#__codelineno-6-78" id="__codelineno-6-78" name="__codelineno-6-78"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">th</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">threads</span><span class="p">)</span>
<a href="#__codelineno-6-79" id="__codelineno-6-79" name="__codelineno-6-79"></a><span class="w">    </span><span class="n">th</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a href="#__codelineno-6-80" id="__codelineno-6-80" name="__codelineno-6-80"></a>
<a href="#__codelineno-6-81" id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-6-82" id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="p">}</span>
</code></pre></div>
</details>
<h3 id="_17">总结<a class="headerlink" href="#_17" title="Permanent link">¶</a></h3>
<p>要点</p>
<ul>
<li>单例模式确保程序中一个类最多只有一个实例</li>
<li>单例模式也提供访问这个实例的全局点</li>
<li>确定在性能和资源上的限制，然后小心地选择适当的方案来实现单例，以解决多线程的问题</li>
<li>如果使用多个类加载器，可能导致单例失效产生多个实例</li>
</ul>
<p>设计原则</p>
<ul>
<li>封装变化</li>
<li>多用组合，少用继承</li>
<li>针对接口编程，不针对实现编程</li>
<li>为了交互对象之间的松耦合设计而努力</li>
<li>类应该对扩展开放，对修改关闭</li>
<li>依赖抽象，不要依赖具体类</li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.tooltips", "content.tabs.link", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.zerolacqua.top/npm/mathjax/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/d3@7/dist/d3.min.js"></script>
      
        <script src="https://unpkg.com/markmap-lib@0.15.3/dist/browser/index.js"></script>
      
        <script src="https://unpkg.com/markmap-view@0.15.3/dist/browser/index.js"></script>
      
    
  </body>
</html>